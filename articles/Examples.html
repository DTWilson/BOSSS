<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Examples • BOSSS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BOSSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/BOSSS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Examples.html">Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Examples</h1>
            
      

      <div class="d-none name"><code>Examples.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtwilson.github.io/BOSSS/">BOSSS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; here() starts at /home/runner/work/BOSSS/BOSSS</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette we provide a few example applications of BOSSS.</p>
<div class="section level2">
<h2 id="nifty">NIFTy<a class="anchor" aria-label="anchor" href="#nifty"></a>
</h2>
<p>The NIFTy trial was open to people having total thyroid surgery and
aimed to find out whether using near-infrared fluorescence imaging could
reduce the number of people whose parathyroid glands become damaged
during thyroid surgery. It was an adaptive design with an interim
analysis based on a (binary) short-term outcome, and a final analysis
based on a (again, binary) long-term outcome.</p>
<p>The design problem here is to choose the sample size and the decision
rule for both the inerim and final analysis. Both analyses used a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>χ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math>
test, so the decision rule could be expressed as the nominal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
used at each stage.</p>
<p>This is the simulation function, exactly as provided by the trial
statistician except for small adjustments to the arguments and return
values to conform to the BOSSS standards.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#n is the total sample size</span></span>
<span><span class="co">#ninterim is the number of patients at the interim analysis (proportion)</span></span>
<span><span class="co">#ainterim is alpha at interim analysis (threshold p-value at interim analysis)</span></span>
<span><span class="co">#afinal is alpha at final analaysis (threshold p-value for 2nd and final analysis)</span></span>
<span><span class="co">#this means overall alpha for the trial is ainterim*afinal</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#pcontshort is the probability of 1 day PoSH in the control arm</span></span>
<span><span class="co">#pexpshort is the probability of 1 day PoSH in the experimental arm</span></span>
<span><span class="co">#pcontlong is the probability of 6 month PoSH in the control arm</span></span>
<span><span class="co">#pexplong is the probability of 6 month PoSH in the experimental arm</span></span>
<span><span class="co">#p01_relative is s.t. p01_relative*pexplong = probability of having </span></span>
<span><span class="co"># a long term outcome after no short term outcome</span></span>
<span></span>
<span><span class="va">sim_trial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">300</span>, <span class="va">ninterim</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">ainterim</span> <span class="op">=</span> <span class="fl">0.4</span>, <span class="va">afinal</span> <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                      <span class="va">pcontshort</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="va">pexpshort</span> <span class="op">=</span> <span class="fl">0.125</span>,</span>
<span>                      <span class="va">pcontlong</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="va">pexplong</span> <span class="op">=</span> <span class="fl">0.03</span>, <span class="va">p01_relative</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">ninterim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">ninterim</span><span class="op">*</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">patients</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="co">#create patients</span></span>
<span>  </span>
<span>  <span class="va">treat</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">n_cont</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">short</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">)</span> <span class="co">#short term outcome</span></span>
<span>  <span class="va">long</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">)</span> <span class="co">#long term outcome</span></span>
<span>  </span>
<span>  <span class="va">data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">patients</span>,<span class="va">treat</span>,<span class="va">short</span>,<span class="va">long</span><span class="op">)</span> <span class="co">#combine into dataset</span></span>
<span>  </span>
<span>  <span class="co">#generate result 1/0 for short term outcome. If short term outcome=0 then long term outcome=0</span></span>
<span>  <span class="co">#If short term outcome=1 then long term outcome has probability pcontlong/pcontshort</span></span>
<span>  <span class="co">#repeat for treatment=2</span></span>
<span>  <span class="co"># for(i in 1:n){</span></span>
<span>  <span class="co">#   if(treat[i]==1){</span></span>
<span>  <span class="co">#     data$short[i]&lt;-rbinom(1,1,pcontshort)</span></span>
<span>  <span class="co">#     if(data$short[i]==0){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-0</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#     if(data$short[i]==1){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-rbinom(1,1,pcontlong/pcontshort)</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#   }</span></span>
<span>  <span class="co">#   else{</span></span>
<span>  <span class="co">#     data$short[i]&lt;-rbinom(1,1,pexpshort)</span></span>
<span>  <span class="co">#     if(data$short[i]==0){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-0</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#     if(data$short[i]==1){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-rbinom(1,1,pexplong/pexpshort)</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#   }</span></span>
<span>  <span class="co"># }</span></span>
<span>  </span>
<span>  <span class="co"># An alternative and more general parametersation of the above model</span></span>
<span>  <span class="co"># to allow different values of probability of a long outcome after</span></span>
<span>  <span class="co"># no short outcome (previously hard coded as 0)</span></span>
<span></span>
<span>  <span class="co"># probability vector p00, p01, p10, p11 in (short, long) form</span></span>
<span>  <span class="co"># Control arm:</span></span>
<span>  <span class="va">p01</span> <span class="op">&lt;-</span> <span class="va">p01_relative</span><span class="op">*</span><span class="va">pcontlong</span></span>
<span>  <span class="va">p11</span> <span class="op">&lt;-</span> <span class="va">pcontlong</span> <span class="op">-</span> <span class="va">p01</span></span>
<span>  <span class="va">p10</span> <span class="op">&lt;-</span> <span class="va">pcontshort</span> <span class="op">-</span> <span class="va">p11</span></span>
<span>  <span class="co"># Simulate outcomes in multinomial format</span></span>
<span>  <span class="va">cont_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_cont</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p01</span> <span class="op">-</span> <span class="va">p10</span> <span class="op">-</span> <span class="va">p11</span><span class="op">)</span>, <span class="va">p01</span>, <span class="va">p10</span>, <span class="va">p11</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Translate these to short and long outcomes</span></span>
<span>  <span class="va">cont_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># shuffle the list randomly</span></span>
<span>  <span class="va">cont_out</span> <span class="op">&lt;-</span> <span class="va">cont_out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cont_out</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Experimental arm:</span></span>
<span>    <span class="co"># Control arm:</span></span>
<span>  <span class="va">p01</span> <span class="op">&lt;-</span> <span class="va">p01_relative</span><span class="op">*</span><span class="va">pexplong</span></span>
<span>  <span class="va">p11</span> <span class="op">&lt;-</span> <span class="va">pexplong</span> <span class="op">-</span> <span class="va">p01</span></span>
<span>  <span class="va">p10</span> <span class="op">&lt;-</span> <span class="va">pexpshort</span> <span class="op">-</span> <span class="va">p11</span></span>
<span>  <span class="va">exp_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span> <span class="op">-</span> <span class="va">n_cont</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p01</span> <span class="op">-</span> <span class="va">p10</span> <span class="op">-</span> <span class="va">p11</span><span class="op">)</span>, <span class="va">p01</span>, <span class="va">p10</span>, <span class="va">p11</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">exp_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">exp_out</span> <span class="op">&lt;-</span> <span class="va">exp_out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_out</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"short"</span>, <span class="st">"long"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cont_out</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"short"</span>, <span class="st">"long"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_out</span></span>
<span>  </span>
<span>  <span class="co">#perform chi squared test on short term outcome for 1st ninterim patients</span></span>
<span>  <span class="va">data2</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ninterim</span>,<span class="op">]</span></span>
<span>  <span class="va">tbl</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">short</span>,<span class="va">data2</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span></span>
<span>  <span class="va">test</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html" class="external-link">chisq.test</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span> <span class="co">#get p-value</span></span>
<span>  </span>
<span>  <span class="co">#if p&lt;ainterim, perform chi squared test on long term outcome for all patients</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">test</span><span class="op">&lt;</span><span class="va">ainterim</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">tbl2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">long</span>,<span class="va">data</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span></span>
<span>    <span class="va">test2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html" class="external-link">chisq.test</a></span><span class="op">(</span><span class="va">tbl2</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#if p&gt;ainterim, trial unsuccessful at interim and final analysis</span></span>
<span>  <span class="co">#if p&lt;ainterim, trial successful at interim:</span></span>
<span>  <span class="co">#if p2&gt;afinal, trial unsuccessful at final analysis</span></span>
<span>  <span class="co">#if p2&lt;afinal, trial successful at final analysis</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">test</span><span class="op">&gt;=</span><span class="va">ainterim</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">FALSE</span>, s <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="va">ninterim</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">test</span><span class="op">&lt;</span><span class="va">ainterim</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span><span class="va">data2</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>,<span class="st">"short"</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span><span class="va">data2</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">2</span>,<span class="st">"short"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">FALSE</span>, s <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="va">ninterim</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">test2</span><span class="op">&gt;</span><span class="va">afinal</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">FALSE</span>, s <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">test2</span><span class="op">&lt;</span><span class="va">afinal</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">TRUE</span>, s <span class="op">=</span> <span class="cn">FALSE</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># For example,</span></span>
<span><span class="fu">sim_trial</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can construct the BOSSS problem object as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Problem specification</span></span>
<span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>,<span class="fl">0.05</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">700</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_trial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypotheses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypotheses.html">hypotheses</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, </span>
<span>                                           <span class="fl">0.25</span>, <span class="fl">0.125</span>, <span class="fl">0.1</span>, <span class="fl">0.03</span>, <span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         hyp_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"null"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                         sim <span class="op">=</span> <span class="va">sim_trial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TI_con"</span>, <span class="st">"TII_con"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g"</span>, <span class="st">"s"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"null"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TI"</span>, <span class="st">"TII"</span>, <span class="st">"EN"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g"</span>, <span class="st">"s"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"null"</span>, <span class="st">"alt"</span>, <span class="st">"null"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span><span class="va">sim_trial</span>, <span class="va">design_space</span>, <span class="va">hypotheses</span>, <span class="va">objectives</span>, <span class="va">constraints</span><span class="op">)</span></span></code></pre></div>
<p>This implies we are going to search over a space of sample sizes and
decision criteria, looking for trial designs which simultaneously
minimise the type I error rate (<code>"TI"</code>), type II error rate
(<code>"TII"</code>) and expected sample size (<code>"EN"</code>),
subject to the type I error rate being (probably) less than 0.1
(<code>"TI_con"</code>) and the type II error rate being (probably) less
than 0.2 (<code>"TIIcon"</code>).</p>
<p>Now we initialise to get an initial estimate of the Pareto front:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialisation</span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         n  ninterim ainterim   afinal</span></span>
<span><span class="co">#&gt; 2  600.00 0.1625000 0.750000 0.250000</span></span>
<span><span class="co">#&gt; 9  575.00 0.4156250 0.812500 0.187500</span></span>
<span><span class="co">#&gt; 13 625.00 0.3593750 0.437500 0.062500</span></span>
<span><span class="co">#&gt; 15 325.00 0.4718750 0.687500 0.312500</span></span>
<span><span class="co">#&gt; 22 587.50 0.2046875 0.718750 0.031250</span></span>
<span><span class="co">#&gt; 27 462.50 0.4578125 0.781250 0.093750</span></span>
<span><span class="co">#&gt; 35 418.75 0.2820313 0.859375 0.328125</span></span>
<span><span class="co">#&gt; 37 668.75 0.3382812 0.734375 0.203125</span></span>
<span><span class="co">#&gt; 39 368.75 0.4507813 0.484375 0.453125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var) n, null (mean)</span></span>
<span><span class="co">#&gt; 2       -3.023783    0.04519900     -1.764057   0.01600202       227.7800</span></span>
<span><span class="co">#&gt; 9       -3.221373    0.05416146     -3.335521   0.06020906       356.6240</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16331377     -2.359280   0.02533537       304.2000</span></span>
<span><span class="co">#&gt; 15      -2.384886    0.02587913     -1.846444   0.01697650       203.9120</span></span>
<span><span class="co">#&gt; 22      -4.226834    0.14091644     -1.474557   0.01318541       280.8200</span></span>
<span><span class="co">#&gt; 27      -3.689289    0.08401554     -2.047467   0.01973883       295.0010</span></span>
<span><span class="co">#&gt; 35      -2.285558    0.02384669     -2.359280   0.02533537       232.2850</span></span>
<span><span class="co">#&gt; 37      -3.118117    0.04925661     -2.856301   0.03887797       366.7945</span></span>
<span><span class="co">#&gt; 39      -2.493162    0.02834157     -1.812902   0.01656951       201.6840</span></span>
<span><span class="co">#&gt;    n, null (var)</span></span>
<span><span class="co">#&gt; 2       97.55297</span></span>
<span><span class="co">#&gt; 9       51.91310</span></span>
<span><span class="co">#&gt; 13      51.55944</span></span>
<span><span class="co">#&gt; 15      12.35437</span></span>
<span><span class="co">#&gt; 22      98.83823</span></span>
<span><span class="co">#&gt; 27      28.19656</span></span>
<span><span class="co">#&gt; 35      42.70572</span></span>
<span><span class="co">#&gt; 37      85.19774</span></span>
<span><span class="co">#&gt; 39      11.94706</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 2       -3.023783    0.04519900     -1.764057   0.01600202</span></span>
<span><span class="co">#&gt; 9       -3.221373    0.05416146     -3.335521   0.06020906</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16331377     -2.359280   0.02533537</span></span>
<span><span class="co">#&gt; 15      -2.384886    0.02587913     -1.846444   0.01697650</span></span>
<span><span class="co">#&gt; 22      -4.226834    0.14091644     -1.474557   0.01318541</span></span>
<span><span class="co">#&gt; 27      -3.689289    0.08401554     -2.047467   0.01973883</span></span>
<span><span class="co">#&gt; 35      -2.285558    0.02384669     -2.359280   0.02533537</span></span>
<span><span class="co">#&gt; 37      -3.118117    0.04925661     -2.856301   0.03887797</span></span>
<span><span class="co">#&gt; 39      -2.493162    0.02834157     -1.812902   0.01656951</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Finally, we iterate a few times to improve that initial
approximation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Iterations</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           n  ninterim  ainterim     afinal</span></span>
<span><span class="co">#&gt; 2  600.0000 0.1625000 0.7500000 0.25000000</span></span>
<span><span class="co">#&gt; 9  575.0000 0.4156250 0.8125000 0.18750000</span></span>
<span><span class="co">#&gt; 13 625.0000 0.3593750 0.4375000 0.06250000</span></span>
<span><span class="co">#&gt; 15 325.0000 0.4718750 0.6875000 0.31250000</span></span>
<span><span class="co">#&gt; 35 418.7500 0.2820313 0.8593750 0.32812500</span></span>
<span><span class="co">#&gt; 39 368.7500 0.4507813 0.4843750 0.45312500</span></span>
<span><span class="co">#&gt; 42 696.7668 0.4555916 0.3326731 0.01782676</span></span>
<span><span class="co">#&gt; 45 516.4745 0.4302293 0.3941854 0.16301852</span></span>
<span><span class="co">#&gt; 47 625.2480 0.4039887 0.4004877 0.18772294</span></span>
<span><span class="co">#&gt; 48 439.6051 0.3664093 0.8074256 0.28307692</span></span>
<span><span class="co">#&gt; 49 621.8103 0.4986784 0.3374450 0.11741606</span></span>
<span><span class="co">#&gt; 50 632.9055 0.4936170 0.5787490 0.35234491</span></span>
<span><span class="co">#&gt; 51 447.1385 0.2720656 0.6455986 0.16845326</span></span>
<span><span class="co">#&gt; 52 611.8022 0.4952288 0.4885986 0.22588945</span></span>
<span><span class="co">#&gt; 53 620.8031 0.4818502 0.1746389 0.04170175</span></span>
<span><span class="co">#&gt; 54 340.3914 0.3331821 0.7793364 0.31243737</span></span>
<span><span class="co">#&gt; 55 490.6632 0.4617599 0.6692496 0.36081964</span></span>
<span><span class="co">#&gt; 56 526.4137 0.3409052 0.4083777 0.08441566</span></span>
<span><span class="co">#&gt; 60 636.9130 0.4997090 0.2507842 0.07803600</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var) n, null (mean)</span></span>
<span><span class="co">#&gt; 2       -3.023783    0.04519900     -1.764057   0.01600202       227.7800</span></span>
<span><span class="co">#&gt; 9       -3.221373    0.05416146     -3.335521   0.06020906       356.6240</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16331377     -2.359280   0.02533537       304.2000</span></span>
<span><span class="co">#&gt; 15      -2.384886    0.02587913     -1.846444   0.01697650       203.9120</span></span>
<span><span class="co">#&gt; 35      -2.285558    0.02384669     -2.359280   0.02533537       232.2850</span></span>
<span><span class="co">#&gt; 39      -2.493162    0.02834157     -1.812902   0.01656951       201.6840</span></span>
<span><span class="co">#&gt; 42      -6.030685    0.83533640     -2.047467   0.01973883       364.0911</span></span>
<span><span class="co">#&gt; 45      -4.094751    0.12398289     -2.150157   0.02138823       265.5822</span></span>
<span><span class="co">#&gt; 47      -3.533378    0.07247929     -2.493162   0.02834157       318.4381</span></span>
<span><span class="co">#&gt; 48      -2.551256    0.02977855     -2.411048   0.02644954       252.9397</span></span>
<span><span class="co">#&gt; 49      -4.556303    0.19432705     -2.895870   0.04027675       344.2991</span></span>
<span><span class="co">#&gt; 50      -2.856301    0.03887797     -3.872426   0.10007918       374.8975</span></span>
<span><span class="co">#&gt; 51      -3.397487    0.06379365     -1.671131   0.01500043       211.0142</span></span>
<span><span class="co">#&gt; 52      -3.118117    0.04925661     -3.335521   0.06020906       366.4389</span></span>
<span><span class="co">#&gt; 53      -5.422544    0.45655261     -1.952320   0.01835923       320.8826</span></span>
<span><span class="co">#&gt; 54      -2.551256    0.02977855     -1.597971   0.01427917       181.6722</span></span>
<span><span class="co">#&gt; 55      -2.437794    0.02704859     -3.118117   0.04925661       299.5764</span></span>
<span><span class="co">#&gt; 56      -5.045842    0.31451121     -1.612318   0.01441616       227.6379</span></span>
<span><span class="co">#&gt; 60      -3.872426    0.10007918     -2.285558   0.02384669       362.0100</span></span>
<span><span class="co">#&gt;    n, null (var)</span></span>
<span><span class="co">#&gt; 2       97.55297</span></span>
<span><span class="co">#&gt; 9       51.91310</span></span>
<span><span class="co">#&gt; 13      51.55944</span></span>
<span><span class="co">#&gt; 15      12.35437</span></span>
<span><span class="co">#&gt; 35      42.70572</span></span>
<span><span class="co">#&gt; 39      11.94706</span></span>
<span><span class="co">#&gt; 42      31.39490</span></span>
<span><span class="co">#&gt; 45      21.91272</span></span>
<span><span class="co">#&gt; 47      40.84945</span></span>
<span><span class="co">#&gt; 48      34.39271</span></span>
<span><span class="co">#&gt; 49      19.07493</span></span>
<span><span class="co">#&gt; 50      32.52114</span></span>
<span><span class="co">#&gt; 51      42.59428</span></span>
<span><span class="co">#&gt; 52      31.68524</span></span>
<span><span class="co">#&gt; 53      13.15239</span></span>
<span><span class="co">#&gt; 54      21.84288</span></span>
<span><span class="co">#&gt; 55      28.17529</span></span>
<span><span class="co">#&gt; 56      29.12191</span></span>
<span><span class="co">#&gt; 60      24.24545</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 2       -3.023783    0.04519900     -1.764057   0.01600202</span></span>
<span><span class="co">#&gt; 9       -3.221373    0.05416146     -3.335521   0.06020906</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16331377     -2.359280   0.02533537</span></span>
<span><span class="co">#&gt; 15      -2.384886    0.02587913     -1.846444   0.01697650</span></span>
<span><span class="co">#&gt; 35      -2.285558    0.02384669     -2.359280   0.02533537</span></span>
<span><span class="co">#&gt; 39      -2.493162    0.02834157     -1.812902   0.01656951</span></span>
<span><span class="co">#&gt; 42      -6.030685    0.83533640     -2.047467   0.01973883</span></span>
<span><span class="co">#&gt; 45      -4.094751    0.12398289     -2.150157   0.02138823</span></span>
<span><span class="co">#&gt; 47      -3.533378    0.07247929     -2.493162   0.02834157</span></span>
<span><span class="co">#&gt; 48      -2.551256    0.02977855     -2.411048   0.02644954</span></span>
<span><span class="co">#&gt; 49      -4.556303    0.19432705     -2.895870   0.04027675</span></span>
<span><span class="co">#&gt; 50      -2.856301    0.03887797     -3.872426   0.10007918</span></span>
<span><span class="co">#&gt; 51      -3.397487    0.06379365     -1.671131   0.01500043</span></span>
<span><span class="co">#&gt; 52      -3.118117    0.04925661     -3.335521   0.06020906</span></span>
<span><span class="co">#&gt; 53      -5.422544    0.45655261     -1.952320   0.01835923</span></span>
<span><span class="co">#&gt; 54      -2.551256    0.02977855     -1.597971   0.01427917</span></span>
<span><span class="co">#&gt; 55      -2.437794    0.02704859     -3.118117   0.04925661</span></span>
<span><span class="co">#&gt; 56      -5.045842    0.31451121     -1.612318   0.01441616</span></span>
<span><span class="co">#&gt; 60      -3.872426    0.10007918     -2.285558   0.02384669</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="pressure-2">PRESSURE 2<a class="anchor" aria-label="anchor" href="#pressure-2"></a>
</h2>
<p>PRESSURE 2 was a trial comparing different mattresses in terms of
their ability to prevent the development of pressure ulcers, with
longitudinal data collected on each patient. Smith et al. (2021)
suggested one way to analyse this data is through a multi-state model,
and showed how simulation could be used to estimate the power of such an
analysis. Herw we will extend this approach to searching for an optimal
design.</p>
<p>The simulation and deterministic functions are:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_P2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">500</span>, <span class="va">fu</span> <span class="op">=</span> <span class="fl">60</span>, <span class="va">af</span> <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                   <span class="va">q12</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">q23</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">q34</span> <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>                   <span class="va">b12</span> <span class="op">=</span> <span class="fl">0.67</span>, <span class="va">b23</span> <span class="op">=</span> <span class="fl">0.67</span>, <span class="va">b34</span> <span class="op">=</span> <span class="fl">0.67</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># n: total number of patients</span></span>
<span>  <span class="co"># fu: follow-up length (days)</span></span>
<span>  <span class="co"># af: assemment frequency (days)</span></span>
<span>  <span class="co"># q12, q23, q34: transition probabilities</span></span>
<span>  <span class="co"># b12, b23, b34: treatment effects</span></span>
<span>  </span>
<span>  <span class="co"># Calculate length of follow up</span></span>
<span>  <span class="va">na</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fu</span><span class="op">/</span><span class="va">af</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Assessment times</span></span>
<span>  <span class="va">as_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">af</span>, <span class="va">fu</span>, <span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Simulate numbers starting in each state</span></span>
<span>  <span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.7</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Randomly allocate treatment</span></span>
<span>  <span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Simulate transitions into each remaining state</span></span>
<span>  <span class="va">enter2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">starts</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">q12</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">b12</span><span class="op">)</span><span class="op">*</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">enter3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">starts</span> <span class="op">!=</span> <span class="fl">3</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">enter2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">q23</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">b23</span><span class="op">)</span><span class="op">*</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">enter4</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">starts</span> <span class="op">!=</span> <span class="fl">3</span><span class="op">)</span><span class="op">*</span><span class="va">enter3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">q34</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">b34</span><span class="op">)</span><span class="op">*</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Matrix of transition times into each state for each patient</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">enter2</span>, <span class="va">enter3</span>, <span class="va">enter4</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add time of "transitioning" to the end of the follow-up period</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">enter_m</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">enter_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, <span class="va">fu</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Cap all times at length of follow-up</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">enter_m</span>, <span class="va">fu</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Ceiling all times, assuming assessment is at the start of the day </span></span>
<span>  <span class="co"># and so any transitions after x.0 will be seen at (x+1).0</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">enter_m</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Translate into number of days spent in each state</span></span>
<span>  <span class="va">times_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">enter_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                   <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                   <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                   <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">times_m</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Reshape to long</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"time"</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="va">trt</span><span class="op">[</span><span class="va">y</span><span class="op">$</span><span class="va">id</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Keep observations on assessment times and order by patient</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">y</span><span class="op">$</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">as_times</span>,<span class="op">]</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># If msm returns an error we take this as a non-significant result</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">msm</span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">time</span>, subject<span class="op">=</span><span class="va">id</span>, data <span class="op">=</span> <span class="va">y</span>, qmatrix <span class="op">=</span> <span class="va">Q</span>,</span>
<span>             covariates <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">==</span> <span class="st">"try-error"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># If not converged, will not return CIs</span></span>
<span>    <span class="va">r1.67</span> <span class="op">&lt;-</span> <span class="fu">hazard.msm</span><span class="op">(</span><span class="va">fit</span>, cl <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.0167</span><span class="op">)</span><span class="op">$</span><span class="va">trt</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">r1.67</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">sig1.67</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">r1.67</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">r1.67</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span></span>
<span>      </span>
<span>      <span class="va">r2.5</span> <span class="op">&lt;-</span> <span class="fu">hazard.msm</span><span class="op">(</span><span class="va">fit</span>, cl <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">)</span><span class="op">$</span><span class="va">trt</span></span>
<span>      <span class="va">sig2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">r2.5</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">r2.5</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span></span>
<span>      </span>
<span>      <span class="va">r5</span> <span class="op">&lt;-</span> <span class="fu">hazard.msm</span><span class="op">(</span><span class="va">fit</span>, cl <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">$</span><span class="va">trt</span></span>
<span>      <span class="va">sig5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">r5</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">r5</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span></span>
<span>      </span>
<span>      <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sig1.67</span>, <span class="va">sig2.5</span>, <span class="va">sig5</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s <span class="op">=</span> <span class="op">!</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">det_P2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">500</span>, <span class="va">fu</span> <span class="op">=</span> <span class="fl">60</span>, <span class="va">af</span> <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                   <span class="va">q12</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">q23</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">q34</span> <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>                   <span class="va">b12</span> <span class="op">=</span> <span class="fl">0.67</span>, <span class="va">b23</span> <span class="op">=</span> <span class="fl">0.67</span>, <span class="va">b34</span> <span class="op">=</span> <span class="fl">0.67</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">na</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fu</span><span class="op">/</span><span class="va">af</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, a <span class="op">=</span> <span class="va">na</span>, f <span class="op">=</span> <span class="va">fu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">sim_P2</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We now construct a problem to encode that we want to search over the
total number of patients, total number of assessments and the assessment
frequency. We are looking for designs which minimise the numbers of
pattens and assessments, whilst constraining the type II error rate to
be (probably) less than 0.2 and the follow-up length to be less than
200.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">60</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_P2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypotheses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypotheses.html">hypotheses</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.03</span>, <span class="fl">0.67</span>, <span class="fl">0.67</span>, <span class="fl">0.67</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         hyp_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                         sim <span class="op">=</span> <span class="va">sim_P2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"a"</span>, <span class="st">"f"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"a"</span>, <span class="st">"f"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span>, <span class="st">"alt"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span><span class="va">sim_P2</span>, <span class="va">design_space</span>, <span class="va">hypotheses</span>, <span class="va">objectives</span>, <span class="va">constraints</span>, det_func <span class="op">=</span> <span class="va">det_P2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           n      fu      af</span></span>
<span><span class="co">#&gt; 9  359.3750 50.6250 8.31250</span></span>
<span><span class="co">#&gt; 11 246.8750 38.1250 1.56250</span></span>
<span><span class="co">#&gt; 13 415.6250 44.3750 4.93750</span></span>
<span><span class="co">#&gt; 17 317.1875 58.4375 4.09375</span></span>
<span><span class="co">#&gt; 18 429.6875 20.9375 1.84375</span></span>
<span><span class="co">#&gt; 21 485.9375 39.6875 9.71875</span></span>
<span><span class="co">#&gt; 26 457.8125 30.3125 3.53125</span></span>
<span><span class="co">#&gt; 29 401.5625 49.0625 6.90625</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n, alt (mean) a, alt (mean) f, alt (mean)</span></span>
<span><span class="co">#&gt; 9       359.3750      2156.250       50.6250</span></span>
<span><span class="co">#&gt; 11      246.8750      5925.000       38.1250</span></span>
<span><span class="co">#&gt; 13      415.6250      3325.000       44.3750</span></span>
<span><span class="co">#&gt; 17      317.1875      4440.625       58.4375</span></span>
<span><span class="co">#&gt; 18      429.6875      4726.562       20.9375</span></span>
<span><span class="co">#&gt; 21      485.9375      1943.750       39.6875</span></span>
<span><span class="co">#&gt; 26      457.8125      3662.500       30.3125</span></span>
<span><span class="co">#&gt; 29      401.5625      2810.938       49.0625</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 9      -2.818081   0.03757873</span></span>
<span><span class="co">#&gt; 11     -1.780150   0.01618577</span></span>
<span><span class="co">#&gt; 13     -2.936892   0.04178691</span></span>
<span><span class="co">#&gt; 17     -3.221373   0.05416146</span></span>
<span><span class="co">#&gt; 18     -1.732408   0.01564970</span></span>
<span><span class="co">#&gt; 21     -2.710611   0.03418256</span></span>
<span><span class="co">#&gt; 26     -2.437794   0.02704859</span></span>
<span><span class="co">#&gt; 29     -3.221373   0.05416146</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           n       fu       af</span></span>
<span><span class="co">#&gt; 9  359.3750 50.62500 8.312500</span></span>
<span><span class="co">#&gt; 11 246.8750 38.12500 1.562500</span></span>
<span><span class="co">#&gt; 14 303.1250 31.87500 2.687500</span></span>
<span><span class="co">#&gt; 18 429.6875 20.93750 1.843750</span></span>
<span><span class="co">#&gt; 34 230.0819 53.88707 6.759177</span></span>
<span><span class="co">#&gt; 38 199.7083 52.63788 3.515716</span></span>
<span><span class="co">#&gt; 39 368.6289 27.57863 3.947984</span></span>
<span><span class="co">#&gt; 42 476.0093 19.61557 2.193718</span></span>
<span><span class="co">#&gt; 43 233.1484 44.00125 4.014669</span></span>
<span><span class="co">#&gt; 46 466.5642 19.70490 1.971585</span></span>
<span><span class="co">#&gt; 47 426.7519 38.53797 9.637794</span></span>
<span><span class="co">#&gt; 49 464.0631 17.94535 1.257592</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n, alt (mean) a, alt (mean) f, alt (mean)</span></span>
<span><span class="co">#&gt; 9       359.3750      2156.250      50.62500</span></span>
<span><span class="co">#&gt; 11      246.8750      5925.000      38.12500</span></span>
<span><span class="co">#&gt; 14      303.1250      3334.375      31.87500</span></span>
<span><span class="co">#&gt; 18      429.6875      4726.562      20.93750</span></span>
<span><span class="co">#&gt; 34      230.0819      1610.573      53.88707</span></span>
<span><span class="co">#&gt; 38      199.7083      2795.917      52.63788</span></span>
<span><span class="co">#&gt; 39      368.6289      2211.773      27.57863</span></span>
<span><span class="co">#&gt; 42      476.0093      3808.074      19.61557</span></span>
<span><span class="co">#&gt; 43      233.1484      2331.484      44.00125</span></span>
<span><span class="co">#&gt; 46      466.5642      4199.077      19.70490</span></span>
<span><span class="co">#&gt; 47      426.7519      1280.256      38.53797</span></span>
<span><span class="co">#&gt; 49      464.0631      6496.883      17.94535</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 9      -2.818081   0.03757873</span></span>
<span><span class="co">#&gt; 11     -1.780150   0.01618577</span></span>
<span><span class="co">#&gt; 14     -1.448401   0.01297212</span></span>
<span><span class="co">#&gt; 18     -1.732408   0.01564970</span></span>
<span><span class="co">#&gt; 34     -1.732408   0.01564970</span></span>
<span><span class="co">#&gt; 38     -1.397322   0.01257317</span></span>
<span><span class="co">#&gt; 39     -1.435480   0.01286903</span></span>
<span><span class="co">#&gt; 42     -1.569679   0.01401522</span></span>
<span><span class="co">#&gt; 43     -1.597971   0.01427917</span></span>
<span><span class="co">#&gt; 46     -1.612318   0.01441616</span></span>
<span><span class="co">#&gt; 47     -1.474557   0.01318541</span></span>
<span><span class="co">#&gt; 49     -1.656207   0.01484864</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="recruitment">Recruitment<a class="anchor" aria-label="anchor" href="#recruitment"></a>
</h2>
<p>Consider a standard two-arm parallel group trial with a continuous
endpoint and a t-test of the group means as the planned analysis.
Suppose that we are concerned about how well this trial will recruit,
and would like to estimate what the overall probability of a significant
result will be when we allow for the uncertainty in attained sample
size. We can approach this by using a hierarchical Poisson-Gamma model
of multi-site recruitment, with site setup times following a Poisson
process. To account for the uncertainty around the true parameter values
in that recruitment model we take a Bayesian view and give priors for
each parameter. This view then also extends to our outcome model, and we
place priors on the mean difference and the outcome standard deviation
too.</p>
<p>The design problem here is to choose both the number of recruiting
sites and the length of the recruitment period. The model parameters are
the hyperparameters of our prior distributions. We want to set a
constraint on the unconditional probability of a type II error under the
hypothesis of interest, and want to minimise the number of sites and the
recruitment period subject to that constraint. We want a simulation
function which returns the conditional power (conditioning on the
attained sample size and the parameters of the outcome model) for any
given design and hypothesis, and a deterministic function to return the
two objective functions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtwilson.github.io/BOSSS/">BOSSS</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_rec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">=</span><span class="fl">20</span>, <span class="va">t</span><span class="op">=</span><span class="fl">3</span>, </span>
<span>                    <span class="va">a</span><span class="op">=</span><span class="fl">7</span>, <span class="va">b</span><span class="op">=</span><span class="fl">2</span>, <span class="va">c</span><span class="op">=</span><span class="fl">2</span>, <span class="va">d</span><span class="op">=</span><span class="fl">0.8</span>, </span>
<span>                    <span class="va">f</span><span class="op">=</span><span class="fl">10</span>, <span class="va">g</span><span class="op">=</span><span class="fl">1</span>, </span>
<span>                    <span class="va">j</span><span class="op">=</span><span class="fl">0.3</span>, <span class="va">k</span><span class="op">=</span><span class="fl">0.3</span>, <span class="va">x</span><span class="op">=</span><span class="fl">1</span>, <span class="va">y</span><span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>  <span class="co"># m - total number of sites to be set up</span></span>
<span>  <span class="co"># t - time (in years) for recruitment</span></span>
<span>  <span class="co"># a, b - hyperparameters for rec mean (gamma)</span></span>
<span>  <span class="co"># c, d - hyperparameters for rec sd (gamma)</span></span>
<span>  <span class="co"># f, g - hyperparameters for eta (gamma)</span></span>
<span>  <span class="co"># j, k - hyperparameters for delta (normal)</span></span>
<span>  <span class="co"># x, y - hyperparameters for sigma (gamma)</span></span>
<span></span>
<span>  <span class="co"># Sample parameters from their priors</span></span>
<span>  <span class="co"># Recruitment rate</span></span>
<span>  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">a</span><span class="op">/</span><span class="va">b</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">b</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">a</span><span class="op">)</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">c</span><span class="op">/</span><span class="va">d</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">d</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">c</span><span class="op">)</span></span>
<span>  <span class="co"># Setup rate</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">f</span><span class="op">/</span><span class="va">g</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">g</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">f</span><span class="op">)</span></span>
<span>  <span class="co"># Treatment effect</span></span>
<span>  <span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">j</span>, <span class="va">k</span><span class="op">)</span></span>
<span>  <span class="co"># Outcome sd</span></span>
<span>  <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># True per year recruitment rates for each site</span></span>
<span>  <span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">alpha</span>, scale<span class="op">=</span><span class="va">beta</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Setup times</span></span>
<span>  <span class="va">setup_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># For each site, simulate number recruited by end</span></span>
<span>  <span class="va">rec_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">setup_ts</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">lambdas</span><span class="op">*</span><span class="va">rec_times</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Total recruited at final</span></span>
<span>  <span class="va">end_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ns</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Cap at target recruitment</span></span>
<span>  <span class="va">end_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">end_n</span>, <span class="fl">352</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Power at analysis</span></span>
<span>  <span class="va">pow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">end_n</span><span class="op">/</span><span class="fl">2</span>, delta <span class="op">=</span> <span class="va">delta</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">$</span><span class="va">power</span></span>
<span>  <span class="va">pow</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>pr_tII <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">pow</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">det_rec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">=</span><span class="fl">20</span>, <span class="va">t</span><span class="op">=</span><span class="fl">3</span>, </span>
<span>                    <span class="va">a</span><span class="op">=</span><span class="fl">7</span>, <span class="va">b</span><span class="op">=</span><span class="fl">2</span>, <span class="va">c</span><span class="op">=</span><span class="fl">2</span>, <span class="va">d</span><span class="op">=</span><span class="fl">0.8</span>, </span>
<span>                    <span class="va">f</span><span class="op">=</span><span class="fl">10</span>, <span class="va">g</span><span class="op">=</span><span class="fl">1</span>, </span>
<span>                    <span class="va">j</span><span class="op">=</span><span class="fl">0.3</span>, <span class="va">k</span><span class="op">=</span><span class="fl">0.3</span>, <span class="va">x</span><span class="op">=</span><span class="fl">1</span>, <span class="va">y</span><span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, t <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># For example,</span></span>
<span><span class="fu">sim_rec</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now we set up the problem using the <code>BOSSS</code> helper
functions. We are going to look at designs with between 3 and 40 sites,
running from between 6 months and 5 years.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Problem specification</span></span>
<span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypotheses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypotheses.html">hypotheses</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0.8</span>, </span>
<span>                                           <span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         hyp_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                         sim <span class="op">=</span> <span class="va">sim_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TII_ass"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pr_tII"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sites"</span>, <span class="st">"Time"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"t"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"alt"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span><span class="va">sim_rec</span>, <span class="va">design_space</span>, <span class="va">hypotheses</span>, <span class="va">objectives</span>, <span class="va">constraints</span>, det_func <span class="op">=</span> <span class="va">det_rec</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Croft J, Ainsworth G, Corrigan N, et al. NIFTy: near-infrared
fluorescence (NIRF) imaging to prevent postsurgical hypoparathyroidism
(PoSH) after thyroid surgery—a phase II/III pragmatic, multicentre
randomised controlled trial protocol in patients undergoing a total or
completion thyroidectomy. <em>BMJ Open</em>, 15:e092422 (2025). <a href="https://doi.org/10.1136/bmjopen-2024-092422" class="external-link uri">https://doi.org/10.1136/bmjopen-2024-092422</a></p></li>
<li><p>Nixon, Jane et al. Pressure Relieving Support Surfaces for
Pressure Ulcer Prevention (PRESSURE 2): Clinical and Health Economic
Results of a Randomised Controlled Trial. <em>eClinicalMedicine</em>,
Volume 14, 42 - 52 (2019)</p></li>
<li><p>Smith IL, Nixon JE, Sharples L. Power and sample size for
multistate model analysis of longitudinal discrete outcomes in disease
prevention trials. <em>Statistics in Medicine</em>, 40: 1960–1971
(2021). <a href="https://doi.org/10.1002/sim.8882" class="external-link uri">https://doi.org/10.1002/sim.8882</a></p></li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_exit.html" class="external-link">knit_exit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Wilson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
