<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Examples • BOSSS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BOSSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/BOSSS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Examples.html">Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Examples</h1>
            
      

      <div class="d-none name"><code>Examples.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtwilson.github.io/BOSSS/">BOSSS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; here() starts at /home/runner/work/BOSSS/BOSSS</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/msm" class="external-link">msm</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette we provide a few example applications of BOSSS.</p>
<div class="section level2">
<h2 id="nifty">NIFTy<a class="anchor" aria-label="anchor" href="#nifty"></a>
</h2>
<p>The NIFTy trial was open to people having total thyroid surgery and
aimed to find out whether using near-infrared fluorescence imaging could
reduce the number of people whose parathyroid glands become damaged
during thyroid surgery. It was an adaptive design with an interim
analysis based on a (binary) short-term outcome, and a final analysis
based on a (again, binary) long-term outcome.</p>
<p>The design problem here is to choose the sample size and the decision
rule for both the inerim and final analysis. Both analyses used a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>χ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math>
test, so the decision rule could be expressed as the nominal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
used at each stage.</p>
<p>This is the simulation function, exactly as provided by the trial
statistician except for small adjustments to the arguments and return
values to conform to the BOSSS standards.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#n is the total sample size</span></span>
<span><span class="co">#ninterim is the number of patients at the interim analysis (proportion)</span></span>
<span><span class="co">#ainterim is alpha at interim analysis (threshold p-value at interim analysis)</span></span>
<span><span class="co">#afinal is alpha at final analaysis (threshold p-value for 2nd and final analysis)</span></span>
<span><span class="co">#this means overall alpha for the trial is ainterim*afinal</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#pcontshort is the probability of 1 day PoSH in the control arm</span></span>
<span><span class="co">#pexpshort is the probability of 1 day PoSH in the experimental arm</span></span>
<span><span class="co">#pcontlong is the probability of 6 month PoSH in the control arm</span></span>
<span><span class="co">#pexplong is the probability of 6 month PoSH in the experimental arm</span></span>
<span><span class="co">#p01_relative is s.t. p01_relative*pexplong = probability of having </span></span>
<span><span class="co"># a long term outcome after no short term outcome</span></span>
<span></span>
<span><span class="va">sim_NIFTy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">300</span>, ninterim <span class="op">=</span> <span class="fl">0.5</span>, ainterim <span class="op">=</span> <span class="fl">0.4</span>, afinal <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                      <span class="va">hypothesis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pcontshort <span class="op">=</span> <span class="fl">0.25</span>, pexpshort <span class="op">=</span> <span class="fl">0.125</span>,</span>
<span>                      pcontlong <span class="op">=</span> <span class="fl">0.1</span>, pexplong <span class="op">=</span> <span class="fl">0.03</span>, p01_relative <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">ninterim</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">ainterim</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>; <span class="va">afinal</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">pcontshort</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">pexpshort</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">pcontlong</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>; <span class="va">pexplong</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>; <span class="va">p01_relative</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">ninterim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">ninterim</span><span class="op">*</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">patients</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="co">#create patients</span></span>
<span>  </span>
<span>  <span class="va">treat</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">n_cont</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">short</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">)</span> <span class="co">#short term outcome</span></span>
<span>  <span class="va">long</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">)</span> <span class="co">#long term outcome</span></span>
<span>  </span>
<span>  <span class="va">data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">patients</span>,<span class="va">treat</span>,<span class="va">short</span>,<span class="va">long</span><span class="op">)</span> <span class="co">#combine into dataset</span></span>
<span>  </span>
<span>  <span class="co">#generate result 1/0 for short term outcome. If short term outcome=0 then long term outcome=0</span></span>
<span>  <span class="co">#If short term outcome=1 then long term outcome has probability pcontlong/pcontshort</span></span>
<span>  <span class="co">#repeat for treatment=2</span></span>
<span>  <span class="co"># for(i in 1:n){</span></span>
<span>  <span class="co">#   if(treat[i]==1){</span></span>
<span>  <span class="co">#     data$short[i]&lt;-rbinom(1,1,pcontshort)</span></span>
<span>  <span class="co">#     if(data$short[i]==0){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-0</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#     if(data$short[i]==1){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-rbinom(1,1,pcontlong/pcontshort)</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#   }</span></span>
<span>  <span class="co">#   else{</span></span>
<span>  <span class="co">#     data$short[i]&lt;-rbinom(1,1,pexpshort)</span></span>
<span>  <span class="co">#     if(data$short[i]==0){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-0</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#     if(data$short[i]==1){</span></span>
<span>  <span class="co">#       data$long[i]&lt;-rbinom(1,1,pexplong/pexpshort)</span></span>
<span>  <span class="co">#     }</span></span>
<span>  <span class="co">#   }</span></span>
<span>  <span class="co"># }</span></span>
<span>  </span>
<span>  <span class="co"># An alternative and more general parametersation of the above model</span></span>
<span>  <span class="co"># to allow different values of probability of a long outcome after</span></span>
<span>  <span class="co"># no short outcome (previously hard coded as 0)</span></span>
<span></span>
<span>  <span class="co"># probability vector p00, p01, p10, p11 in (short, long) form</span></span>
<span>  <span class="co"># Control arm:</span></span>
<span>  <span class="va">p01</span> <span class="op">&lt;-</span> <span class="va">p01_relative</span><span class="op">*</span><span class="va">pcontlong</span></span>
<span>  <span class="va">p11</span> <span class="op">&lt;-</span> <span class="va">pcontlong</span> <span class="op">-</span> <span class="va">p01</span></span>
<span>  <span class="va">p10</span> <span class="op">&lt;-</span> <span class="va">pcontshort</span> <span class="op">-</span> <span class="va">p11</span></span>
<span>  <span class="co"># Simulate outcomes in multinomial format</span></span>
<span>  <span class="va">cont_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_cont</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p01</span> <span class="op">-</span> <span class="va">p10</span> <span class="op">-</span> <span class="va">p11</span><span class="op">)</span>, <span class="va">p01</span>, <span class="va">p10</span>, <span class="va">p11</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Translate these to short and long outcomes</span></span>
<span>  <span class="va">cont_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">cont_count</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># shuffle the list randomly</span></span>
<span>  <span class="va">cont_out</span> <span class="op">&lt;-</span> <span class="va">cont_out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cont_out</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Experimental arm:</span></span>
<span>    <span class="co"># Control arm:</span></span>
<span>  <span class="va">p01</span> <span class="op">&lt;-</span> <span class="va">p01_relative</span><span class="op">*</span><span class="va">pexplong</span></span>
<span>  <span class="va">p11</span> <span class="op">&lt;-</span> <span class="va">pexplong</span> <span class="op">-</span> <span class="va">p01</span></span>
<span>  <span class="va">p10</span> <span class="op">&lt;-</span> <span class="va">pexpshort</span> <span class="op">-</span> <span class="va">p11</span></span>
<span>  <span class="va">exp_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span> <span class="op">-</span> <span class="va">n_cont</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p01</span> <span class="op">-</span> <span class="va">p10</span> <span class="op">-</span> <span class="va">p11</span><span class="op">)</span>, <span class="va">p01</span>, <span class="va">p10</span>, <span class="va">p11</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">exp_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">exp_count</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">exp_out</span> <span class="op">&lt;-</span> <span class="va">exp_out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_out</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"short"</span>, <span class="st">"long"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cont_out</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"short"</span>, <span class="st">"long"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_out</span></span>
<span>  </span>
<span>  <span class="co">#perform chi squared test on short term outcome for 1st ninterim patients</span></span>
<span>  <span class="va">data2</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">ninterim</span>,<span class="op">]</span></span>
<span>  <span class="va">tbl</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">short</span>,<span class="va">data2</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span></span>
<span>  <span class="va">test</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html" class="external-link">chisq.test</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span> <span class="co">#get p-value</span></span>
<span>  </span>
<span>  <span class="co">#if p&lt;ainterim, perform chi squared test on long term outcome for all patients</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">test</span><span class="op">&lt;</span><span class="va">ainterim</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">tbl2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">long</span>,<span class="va">data</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span></span>
<span>    <span class="va">test2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html" class="external-link">chisq.test</a></span><span class="op">(</span><span class="va">tbl2</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#if p&gt;ainterim, trial unsuccessful at interim and final analysis</span></span>
<span>  <span class="co">#if p&lt;ainterim, trial successful at interim:</span></span>
<span>  <span class="co">#if p2&gt;afinal, trial unsuccessful at final analysis</span></span>
<span>  <span class="co">#if p2&lt;afinal, trial successful at final analysis</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">test</span><span class="op">&gt;=</span><span class="va">ainterim</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">FALSE</span>, s <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="va">ninterim</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">test</span><span class="op">&lt;</span><span class="va">ainterim</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span><span class="va">data2</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>,<span class="st">"short"</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span><span class="va">data2</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">2</span>,<span class="st">"short"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">FALSE</span>, s <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="va">ninterim</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">test2</span><span class="op">&gt;</span><span class="va">afinal</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">FALSE</span>, s <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">test2</span><span class="op">&lt;</span><span class="va">afinal</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>g <span class="op">=</span> <span class="cn">TRUE</span>, s <span class="op">=</span> <span class="cn">FALSE</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># For example,</span></span>
<span><span class="fu">sim_NIFTy</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can construct the BOSSS problem object as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Problem specification</span></span>
<span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>,<span class="fl">0.05</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">700</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_NIFTy</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypotheses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypotheses.html">hypotheses</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, </span>
<span>                                           <span class="fl">0.25</span>, <span class="fl">0.125</span>, <span class="fl">0.1</span>, <span class="fl">0.03</span>, <span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         hyp_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"null"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                         sim <span class="op">=</span> <span class="va">sim_NIFTy</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TI_con"</span>, <span class="st">"TII_con"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g"</span>, <span class="st">"s"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"null"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TI"</span>, <span class="st">"TII"</span>, <span class="st">"EN"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g"</span>, <span class="st">"s"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"null"</span>, <span class="st">"alt"</span>, <span class="st">"null"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span>sim_trial <span class="op">=</span> <span class="va">sim_NIFTy</span>,</span>
<span>                      design_space <span class="op">=</span> <span class="va">design_space</span>,</span>
<span>                      objectives <span class="op">=</span> <span class="va">objectives</span>,</span>
<span>                      hypotheses <span class="op">=</span> <span class="va">hypotheses</span>,</span>
<span>                      constraints <span class="op">=</span> <span class="va">constraints</span><span class="op">)</span></span></code></pre></div>
<p>This implies we are going to search over a space of sample sizes and
decision criteria, looking for trial designs which simultaneously
minimise the type I error rate (<code>"TI"</code>), type II error rate
(<code>"TII"</code>) and expected sample size (<code>"EN"</code>),
subject to the type I error rate being (probably) less than 0.1
(<code>"TI_con"</code>) and the type II error rate being (probably) less
than 0.2 (<code>"TIIcon"</code>).</p>
<p>Now we initialise to get an initial estimate of the Pareto front:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">987953021</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialisation</span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">ptm</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         n  ninterim ainterim   afinal</span></span>
<span><span class="co">#&gt; 2  600.00 0.1625000 0.750000 0.250000</span></span>
<span><span class="co">#&gt; 9  575.00 0.4156250 0.812500 0.187500</span></span>
<span><span class="co">#&gt; 13 625.00 0.3593750 0.437500 0.062500</span></span>
<span><span class="co">#&gt; 15 325.00 0.4718750 0.687500 0.312500</span></span>
<span><span class="co">#&gt; 22 587.50 0.2046875 0.718750 0.031250</span></span>
<span><span class="co">#&gt; 27 462.50 0.4578125 0.781250 0.093750</span></span>
<span><span class="co">#&gt; 35 418.75 0.2820313 0.859375 0.328125</span></span>
<span><span class="co">#&gt; 37 668.75 0.3382812 0.734375 0.203125</span></span>
<span><span class="co">#&gt; 39 368.75 0.4507813 0.484375 0.453125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var) n, null (mean)</span></span>
<span><span class="co">#&gt; 2       -2.895870    0.04030898     -1.626804   0.01456830       245.8880</span></span>
<span><span class="co">#&gt; 9       -2.581421    0.03058315     -3.463266   0.06790476       362.6900</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16344445     -1.898346   0.01764933       297.7840</span></span>
<span><span class="co">#&gt; 15      -2.856301    0.03890908     -1.671131   0.01501243       197.0320</span></span>
<span><span class="co">#&gt; 22      -4.556303    0.19448254     -1.461425   0.01308801       269.6000</span></span>
<span><span class="co">#&gt; 27      -4.094751    0.12408210     -2.150157   0.02140535       284.9410</span></span>
<span><span class="co">#&gt; 35      -2.309640    0.02434019     -2.334207   0.02483631       225.6685</span></span>
<span><span class="co">#&gt; 37      -2.856301    0.03890908     -3.276937   0.05706450       349.0845</span></span>
<span><span class="co">#&gt; 39      -2.359280    0.02535564     -1.863526   0.01720311       207.7665</span></span>
<span><span class="co">#&gt;    n, null (var)</span></span>
<span><span class="co">#&gt; 2      105.65737</span></span>
<span><span class="co">#&gt; 9       53.05197</span></span>
<span><span class="co">#&gt; 13      48.38338</span></span>
<span><span class="co">#&gt; 15      11.29196</span></span>
<span><span class="co">#&gt; 22      95.30629</span></span>
<span><span class="co">#&gt; 27      26.31040</span></span>
<span><span class="co">#&gt; 35      41.66091</span></span>
<span><span class="co">#&gt; 37      78.84944</span></span>
<span><span class="co">#&gt; 39      13.47438</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 2       -2.895870    0.04030898     -1.626804   0.01456830</span></span>
<span><span class="co">#&gt; 9       -2.581421    0.03058315     -3.463266   0.06790476</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16344445     -1.898346   0.01764933</span></span>
<span><span class="co">#&gt; 15      -2.856301    0.03890908     -1.671131   0.01501243</span></span>
<span><span class="co">#&gt; 22      -4.556303    0.19448254     -1.461425   0.01308801</span></span>
<span><span class="co">#&gt; 27      -4.094751    0.12408210     -2.150157   0.02140535</span></span>
<span><span class="co">#&gt; 35      -2.309640    0.02434019     -2.334207   0.02483631</span></span>
<span><span class="co">#&gt; 37      -2.856301    0.03890908     -3.276937   0.05706450</span></span>
<span><span class="co">#&gt; 39      -2.359280    0.02535564     -1.863526   0.01720311</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Finally, we iterate a few times to improve that initial
approximation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Iterations</span></span>
<span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">ptm</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           n  ninterim   ainterim     afinal</span></span>
<span><span class="co">#&gt; 9  575.0000 0.4156250 0.81250000 0.18750000</span></span>
<span><span class="co">#&gt; 13 625.0000 0.3593750 0.43750000 0.06250000</span></span>
<span><span class="co">#&gt; 15 325.0000 0.4718750 0.68750000 0.31250000</span></span>
<span><span class="co">#&gt; 27 462.5000 0.4578125 0.78125000 0.09375000</span></span>
<span><span class="co">#&gt; 37 668.7500 0.3382812 0.73437500 0.20312500</span></span>
<span><span class="co">#&gt; 39 368.7500 0.4507813 0.48437500 0.45312500</span></span>
<span><span class="co">#&gt; 42 693.5662 0.4949120 0.27456863 0.02329762</span></span>
<span><span class="co">#&gt; 43 698.4236 0.4747349 0.72489771 0.12223652</span></span>
<span><span class="co">#&gt; 45 691.9437 0.4645113 0.73323696 0.27106134</span></span>
<span><span class="co">#&gt; 46 450.3917 0.3152930 0.66498311 0.12892175</span></span>
<span><span class="co">#&gt; 47 469.9705 0.3903419 0.72850417 0.28434527</span></span>
<span><span class="co">#&gt; 48 392.7671 0.2651745 0.71856545 0.29197172</span></span>
<span><span class="co">#&gt; 49 437.7276 0.3502485 0.69773093 0.26460208</span></span>
<span><span class="co">#&gt; 51 546.2313 0.4977586 0.41949884 0.20778485</span></span>
<span><span class="co">#&gt; 53 699.0088 0.4991350 0.33036663 0.11854772</span></span>
<span><span class="co">#&gt; 54 348.5348 0.3229493 0.71953816 0.33433016</span></span>
<span><span class="co">#&gt; 55 699.3476 0.4948859 0.05700285 0.09839968</span></span>
<span><span class="co">#&gt; 56 698.5863 0.4972386 0.20772586 0.08912535</span></span>
<span><span class="co">#&gt; 57 698.6434 0.2916672 0.31607825 0.10865194</span></span>
<span><span class="co">#&gt; 58 504.1285 0.4338548 0.66805138 0.32772313</span></span>
<span><span class="co">#&gt; 59 462.4255 0.2831918 0.58560022 0.14097364</span></span>
<span><span class="co">#&gt; 60 691.7141 0.4942135 0.49990569 0.13285708</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var) n, null (mean)</span></span>
<span><span class="co">#&gt; 9       -2.581421    0.03058315     -3.463266   0.06790476       362.6900</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16344445     -1.898346   0.01764933       297.7840</span></span>
<span><span class="co">#&gt; 15      -2.856301    0.03890908     -1.671131   0.01501243       197.0320</span></span>
<span><span class="co">#&gt; 27      -4.094751    0.12408210     -2.150157   0.02140535       284.9410</span></span>
<span><span class="co">#&gt; 37      -2.856301    0.03890908     -3.276937   0.05706450       349.0845</span></span>
<span><span class="co">#&gt; 39      -2.359280    0.02535564     -1.863526   0.01720311       207.7665</span></span>
<span><span class="co">#&gt; 42      -7.824446    5.00600080     -2.047467   0.01975463       387.1713</span></span>
<span><span class="co">#&gt; 43      -3.276937    0.05706450     -3.397487   0.06384469       447.1059</span></span>
<span><span class="co">#&gt; 45      -2.745316    0.03526753     -4.226834   0.14102920       436.7344</span></span>
<span><span class="co">#&gt; 46      -3.689289    0.08408277     -1.716844   0.01549312       216.6308</span></span>
<span><span class="co">#&gt; 47      -2.437794    0.02707023     -2.521850   0.02906385       270.8130</span></span>
<span><span class="co">#&gt; 48      -2.644208    0.03228670     -1.641433   0.01471253       185.4323</span></span>
<span><span class="co">#&gt; 49      -2.936892    0.04182035     -1.898346   0.01764933       222.4735</span></span>
<span><span class="co">#&gt; 51      -3.335521    0.06025724     -2.411048   0.02647070       329.3490</span></span>
<span><span class="co">#&gt; 53      -3.689289    0.08408277     -3.335521   0.06025724       392.2271</span></span>
<span><span class="co">#&gt; 54      -2.411048    0.02647070     -1.656207   0.01486053       176.8105</span></span>
<span><span class="co">#&gt; 55      -6.030685    0.83600481     -1.583759   0.01415688       355.8937</span></span>
<span><span class="co">#&gt; 56      -4.378391    0.16344445     -2.493162   0.02836425       376.5333</span></span>
<span><span class="co">#&gt; 57      -4.771895    0.24030264     -1.780150   0.01619872       269.4162</span></span>
<span><span class="co">#&gt; 58      -2.285558    0.02386577     -3.118117   0.04929603       300.9773</span></span>
<span><span class="co">#&gt; 59      -3.533378    0.07253729     -1.569679   0.01402643       215.7658</span></span>
<span><span class="co">#&gt; 60      -3.608458    0.07787237     -3.335521   0.06025724       410.4414</span></span>
<span><span class="co">#&gt;    n, null (var)</span></span>
<span><span class="co">#&gt; 9      53.051972</span></span>
<span><span class="co">#&gt; 13     48.383377</span></span>
<span><span class="co">#&gt; 15     11.291958</span></span>
<span><span class="co">#&gt; 27     26.310401</span></span>
<span><span class="co">#&gt; 37     78.849435</span></span>
<span><span class="co">#&gt; 39     13.474383</span></span>
<span><span class="co">#&gt; 42     27.121986</span></span>
<span><span class="co">#&gt; 43     58.475890</span></span>
<span><span class="co">#&gt; 45     59.191370</span></span>
<span><span class="co">#&gt; 46     34.961456</span></span>
<span><span class="co">#&gt; 47     35.047317</span></span>
<span><span class="co">#&gt; 48     33.835167</span></span>
<span><span class="co">#&gt; 49     29.968867</span></span>
<span><span class="co">#&gt; 51     25.360469</span></span>
<span><span class="co">#&gt; 53     27.190516</span></span>
<span><span class="co">#&gt; 54     22.303688</span></span>
<span><span class="co">#&gt; 55      6.809701</span></span>
<span><span class="co">#&gt; 56     19.060671</span></span>
<span><span class="co">#&gt; 57     57.129542</span></span>
<span><span class="co">#&gt; 58     33.781442</span></span>
<span><span class="co">#&gt; 59     42.394723</span></span>
<span><span class="co">#&gt; 60     39.142223</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    g, null (mean) g, null (var) s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 9       -2.581421    0.03058315     -3.463266   0.06790476</span></span>
<span><span class="co">#&gt; 13      -4.378391    0.16344445     -1.898346   0.01764933</span></span>
<span><span class="co">#&gt; 15      -2.856301    0.03890908     -1.671131   0.01501243</span></span>
<span><span class="co">#&gt; 27      -4.094751    0.12408210     -2.150157   0.02140535</span></span>
<span><span class="co">#&gt; 37      -2.856301    0.03890908     -3.276937   0.05706450</span></span>
<span><span class="co">#&gt; 39      -2.359280    0.02535564     -1.863526   0.01720311</span></span>
<span><span class="co">#&gt; 42      -7.824446    5.00600080     -2.047467   0.01975463</span></span>
<span><span class="co">#&gt; 43      -3.276937    0.05706450     -3.397487   0.06384469</span></span>
<span><span class="co">#&gt; 45      -2.745316    0.03526753     -4.226834   0.14102920</span></span>
<span><span class="co">#&gt; 46      -3.689289    0.08408277     -1.716844   0.01549312</span></span>
<span><span class="co">#&gt; 47      -2.437794    0.02707023     -2.521850   0.02906385</span></span>
<span><span class="co">#&gt; 48      -2.644208    0.03228670     -1.641433   0.01471253</span></span>
<span><span class="co">#&gt; 49      -2.936892    0.04182035     -1.898346   0.01764933</span></span>
<span><span class="co">#&gt; 51      -3.335521    0.06025724     -2.411048   0.02647070</span></span>
<span><span class="co">#&gt; 53      -3.689289    0.08408277     -3.335521   0.06025724</span></span>
<span><span class="co">#&gt; 54      -2.411048    0.02647070     -1.656207   0.01486053</span></span>
<span><span class="co">#&gt; 55      -6.030685    0.83600481     -1.583759   0.01415688</span></span>
<span><span class="co">#&gt; 56      -4.378391    0.16344445     -2.493162   0.02836425</span></span>
<span><span class="co">#&gt; 57      -4.771895    0.24030264     -1.780150   0.01619872</span></span>
<span><span class="co">#&gt; 58      -2.285558    0.02386577     -3.118117   0.04929603</span></span>
<span><span class="co">#&gt; 59      -3.533378    0.07253729     -1.569679   0.01402643</span></span>
<span><span class="co">#&gt; 60      -3.608458    0.07787237     -3.335521   0.06025724</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PS_empirical_ests.html">PS_empirical_ests</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">p</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">p</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">p</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$n$"</span>, <span class="st">"$n_{int}$"</span>, <span class="st">"$\\alpha_{int}$"</span>, <span class="st">"$\\alpha_{f}$"</span>,</span>
<span>                       <span class="st">"$E[g ~|~ H_0]$"</span>, <span class="st">"$E[s ~|~ H_1]$"</span>, <span class="st">"$E[N ~|~ H_0]$"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print(xtable(df, digits = c(0,0,2,2,2,2,2,0)), booktabs = T, include.rownames = T, sanitize.text.function = function(x) {x}, floating = F, file = here("man", "tables", "NIFTy.txt"))</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#ggsave(here("man", "figures", "NIFTy.pdf"), height=9, width=14, units="cm")</span></span></code></pre></div>
<p>From this set of efficient solutions, suppose we judge number 49 to
offer the best trade-offs. Checking that design gives:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">)</span> <span class="op">==</span> <span class="fl">49</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_check_point.html">diag_check_point</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span>, N<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Model 1 prediction interval: [0.052, 0.066]</span></span>
<span><span class="co"># Model 1 empirical interval: [0.06, 0.063]</span></span>
<span></span>
<span><span class="co"># Model 2 prediction interval: [0.101, 0.13]</span></span>
<span><span class="co"># Model 2 empirical interval: [0.109, 0.113]</span></span>
<span></span>
<span><span class="co"># Model 3 prediction interval: [224.613, 233.95]</span></span>
<span><span class="co"># Model 3 empirical interval: [230.007, 231.58]</span></span></code></pre></div>
<p>This confirms that this specific design is well within our two
constraints, and also suggests the three GP models are fitting the
simulated data well.</p>
</div>
<div class="section level2">
<h2 id="pressure-2">PRESSURE 2<a class="anchor" aria-label="anchor" href="#pressure-2"></a>
</h2>
<p>PRESSURE 2 was a trial comparing different mattresses in terms of
their ability to prevent the development of pressure ulcers, with
longitudinal data collected on each patient. Smith et al. (2021)
suggested one way to analyse this data is through a multi-state model,
and showed how simulation could be used to estimate the power of such an
analysis. Herw we will extend this approach to searching for an optimal
design.</p>
<p>The simulation and deterministic functions are:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_P2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span>, fu <span class="op">=</span> <span class="fl">60</span>, af <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   <span class="va">hypothesis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q12 <span class="op">=</span> <span class="fl">0.05</span>, q23 <span class="op">=</span> <span class="fl">0.05</span>, q34 <span class="op">=</span> <span class="fl">0.03</span>, </span>
<span>                                     b12 <span class="op">=</span> <span class="fl">0.67</span>, b23 <span class="op">=</span> <span class="fl">0.67</span>, b34 <span class="op">=</span> <span class="fl">0.67</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># n: total number of patients</span></span>
<span>  <span class="co"># fu: follow-up length (days)</span></span>
<span>  <span class="co"># af: assemment frequency (days)</span></span>
<span>  <span class="co"># q12, q23, q34: transition probabilities</span></span>
<span>  <span class="co"># b12, b23, b34: treatment effects</span></span>
<span>  </span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">fu</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>; <span class="va">af</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">q12</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">q23</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>; <span class="va">q34</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> </span>
<span>  <span class="va">b12</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>; <span class="va">b23</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>; <span class="va">b34</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Calculate length of follow up</span></span>
<span>  <span class="va">na</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fu</span><span class="op">/</span><span class="va">af</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Assessment times</span></span>
<span>  <span class="va">as_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">af</span>, <span class="va">fu</span>, <span class="va">af</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Simulate numbers starting in each state</span></span>
<span>  <span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.7</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Randomly allocate treatment</span></span>
<span>  <span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Simulate transitions into each remaining state</span></span>
<span>  <span class="va">enter2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">starts</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">q12</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">b12</span><span class="op">)</span><span class="op">*</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">enter3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">starts</span> <span class="op">!=</span> <span class="fl">3</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">enter2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">q23</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">b23</span><span class="op">)</span><span class="op">*</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">enter4</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">starts</span> <span class="op">!=</span> <span class="fl">3</span><span class="op">)</span><span class="op">*</span><span class="va">enter3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">q34</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">b34</span><span class="op">)</span><span class="op">*</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Matrix of transition times into each state for each patient</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">enter2</span>, <span class="va">enter3</span>, <span class="va">enter4</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add time of "transitioning" to the end of the follow-up period</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">enter_m</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">enter_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, <span class="va">fu</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Cap all times at length of follow-up</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">enter_m</span>, <span class="va">fu</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Ceiling all times, assuming assessment is at the start of the day </span></span>
<span>  <span class="co"># and so any transitions after x.0 will be seen at (x+1).0</span></span>
<span>  <span class="va">enter_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">enter_m</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Translate into number of days spent in each state</span></span>
<span>  <span class="va">times_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">enter_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                   <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                   <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                   <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">enter_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">times_m</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Reshape to long</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"time"</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="va">trt</span><span class="op">[</span><span class="va">y</span><span class="op">$</span><span class="va">id</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Keep observations on assessment times and order by patient</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">y</span><span class="op">$</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">as_times</span>,<span class="op">]</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># If msm returns an error we take this as a non-significant result</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">msm</span><span class="fu">::</span><span class="fu"><a href="https://chjackson.github.io/msm/reference/msm.html" class="external-link">msm</a></span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">time</span>, subject<span class="op">=</span><span class="va">id</span>, data <span class="op">=</span> <span class="va">y</span>, qmatrix <span class="op">=</span> <span class="va">Q</span>,</span>
<span>             covariates <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">==</span> <span class="st">"try-error"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># If not converged, will not return CIs</span></span>
<span>    <span class="va">r1.67</span> <span class="op">&lt;-</span> <span class="fu">msm</span><span class="fu">::</span><span class="fu"><a href="https://chjackson.github.io/msm/reference/hazard.msm.html" class="external-link">hazard.msm</a></span><span class="op">(</span><span class="va">fit</span>, cl <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.0167</span><span class="op">)</span><span class="op">$</span><span class="va">trt</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">r1.67</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">sig1.67</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">r1.67</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">r1.67</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span></span>
<span>      </span>
<span>      <span class="va">r2.5</span> <span class="op">&lt;-</span> <span class="fu">msm</span><span class="fu">::</span><span class="fu"><a href="https://chjackson.github.io/msm/reference/hazard.msm.html" class="external-link">hazard.msm</a></span><span class="op">(</span><span class="va">fit</span>, cl <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">)</span><span class="op">$</span><span class="va">trt</span></span>
<span>      <span class="va">sig2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">r2.5</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">r2.5</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span></span>
<span>      </span>
<span>      <span class="va">r5</span> <span class="op">&lt;-</span> <span class="fu">msm</span><span class="fu">::</span><span class="fu"><a href="https://chjackson.github.io/msm/reference/hazard.msm.html" class="external-link">hazard.msm</a></span><span class="op">(</span><span class="va">fit</span>, cl <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">$</span><span class="va">trt</span></span>
<span>      <span class="va">sig5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">r5</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">r5</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span></span>
<span>      </span>
<span>      <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sig1.67</span>, <span class="va">sig2.5</span>, <span class="va">sig5</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s <span class="op">=</span> <span class="op">!</span><span class="va">sig</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">det_P2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span>, fu <span class="op">=</span> <span class="fl">60</span>, af <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   <span class="va">hypothesis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q12 <span class="op">=</span> <span class="fl">0.05</span>, q23 <span class="op">=</span> <span class="fl">0.05</span>, q34 <span class="op">=</span> <span class="fl">0.03</span>, </span>
<span>                                     b12 <span class="op">=</span> <span class="fl">0.67</span>, b23 <span class="op">=</span> <span class="fl">0.67</span>, b34 <span class="op">=</span> <span class="fl">0.67</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># n: total number of patients</span></span>
<span>  <span class="co"># fu: follow-up length (days)</span></span>
<span>  <span class="co"># af: assemment frequency (days)</span></span>
<span>  <span class="co"># q12, q23, q34: transition probabilities</span></span>
<span>  <span class="co"># b12, b23, b34: treatment effects</span></span>
<span>  </span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">fu</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>; <span class="va">af</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">q12</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">q23</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>; <span class="va">q34</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> </span>
<span>  <span class="va">b12</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>; <span class="va">b23</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>; <span class="va">b34</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">na</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fu</span><span class="op">/</span><span class="va">af</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, a <span class="op">=</span> <span class="va">na</span>, f <span class="op">=</span> <span class="va">fu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">sim_P2</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We now construct a problem to encode that we want to search over the
total number of patients, total number of assessments and the assessment
frequency. We are looking for designs which minimise the numbers of
pattens and assessments, whilst constraining the type II error rate to
be (probably) less than 0.2 and the follow-up length to be less than
200.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">60</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_P2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"a"</span>, <span class="st">"f"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"a"</span>, <span class="st">"f"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span>sim_trial <span class="op">=</span> <span class="va">sim_P2</span>,</span>
<span>                      design_space <span class="op">=</span> <span class="va">design_space</span>,</span>
<span>                      objectives <span class="op">=</span> <span class="va">objectives</span>,</span>
<span>                      constraints <span class="op">=</span> <span class="va">constraints</span>,</span>
<span>                      det_func <span class="op">=</span> <span class="va">det_P2</span><span class="op">)</span></span></code></pre></div>
<p>Note that we haven’t specified a set of hypotheses; because we only
need to simulate under a single hypothesis (to estimate the type II
error rate), we can leave it to be specified implicitly through the
default <code>hypothesis</code> argument of the simulation function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">327324</span><span class="op">)</span></span>
<span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">ptm</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           n      fu      af</span></span>
<span><span class="co">#&gt; 9  359.3750 50.6250 8.31250</span></span>
<span><span class="co">#&gt; 13 415.6250 44.3750 4.93750</span></span>
<span><span class="co">#&gt; 17 317.1875 58.4375 4.09375</span></span>
<span><span class="co">#&gt; 21 485.9375 39.6875 9.71875</span></span>
<span><span class="co">#&gt; 25 345.3125 42.8125 1.28125</span></span>
<span><span class="co">#&gt; 26 457.8125 30.3125 3.53125</span></span>
<span><span class="co">#&gt; 29 401.5625 49.0625 6.90625</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n, default (mean) a, default (mean) f, default (mean)</span></span>
<span><span class="co">#&gt; 9           359.3750          2156.250           50.6250</span></span>
<span><span class="co">#&gt; 13          415.6250          3325.000           44.3750</span></span>
<span><span class="co">#&gt; 17          317.1875          4440.625           58.4375</span></span>
<span><span class="co">#&gt; 21          485.9375          1943.750           39.6875</span></span>
<span><span class="co">#&gt; 25          345.3125         11395.312           42.8125</span></span>
<span><span class="co">#&gt; 26          457.8125          3662.500           30.3125</span></span>
<span><span class="co">#&gt; 29          401.5625          2810.938           49.0625</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, default (mean) s, default (var)</span></span>
<span><span class="co">#&gt; 9          -2.419826        0.1333284</span></span>
<span><span class="co">#&gt; 13         -3.131345        0.2494842</span></span>
<span><span class="co">#&gt; 17         -3.131345        0.2494842</span></span>
<span><span class="co">#&gt; 21         -2.560667        0.1502170</span></span>
<span><span class="co">#&gt; 25         -2.907321        0.2036231</span></span>
<span><span class="co">#&gt; 26         -3.798549        0.4665877</span></span>
<span><span class="co">#&gt; 29         -3.798549        0.4665877</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">ptm</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           n       fu       af</span></span>
<span><span class="co">#&gt; 14 303.1250 31.87500 2.687500</span></span>
<span><span class="co">#&gt; 31 226.7023 49.48812 3.543657</span></span>
<span><span class="co">#&gt; 32 437.1483 24.37747 3.068252</span></span>
<span><span class="co">#&gt; 33 371.7745 33.72155 6.758731</span></span>
<span><span class="co">#&gt; 36 282.0871 36.80602 3.688027</span></span>
<span><span class="co">#&gt; 37 248.6326 50.85734 6.359775</span></span>
<span><span class="co">#&gt; 39 208.7821 53.31176 4.102278</span></span>
<span><span class="co">#&gt; 40 410.2598 27.16768 4.539190</span></span>
<span><span class="co">#&gt; 41 213.8159 54.30283 4.537738</span></span>
<span><span class="co">#&gt; 43 482.4240 22.17029 3.195361</span></span>
<span><span class="co">#&gt; 44 341.9060 44.84317 8.973592</span></span>
<span><span class="co">#&gt; 45 363.7644 30.17949 5.041646</span></span>
<span><span class="co">#&gt; 46 252.3668 42.81866 4.340260</span></span>
<span><span class="co">#&gt; 47 213.8567 52.59133 4.047495</span></span>
<span><span class="co">#&gt; 48 479.9210 25.29238 5.113757</span></span>
<span><span class="co">#&gt; 50 207.7006 53.61345 3.412483</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n, default (mean) a, default (mean) f, default (mean)</span></span>
<span><span class="co">#&gt; 14          303.1250          3334.375          31.87500</span></span>
<span><span class="co">#&gt; 31          226.7023          2947.129          49.48812</span></span>
<span><span class="co">#&gt; 32          437.1483          3060.038          24.37747</span></span>
<span><span class="co">#&gt; 33          371.7745          1487.098          33.72155</span></span>
<span><span class="co">#&gt; 36          282.0871          2538.783          36.80602</span></span>
<span><span class="co">#&gt; 37          248.6326          1740.428          50.85734</span></span>
<span><span class="co">#&gt; 39          208.7821          2505.385          53.31176</span></span>
<span><span class="co">#&gt; 40          410.2598          2051.299          27.16768</span></span>
<span><span class="co">#&gt; 41          213.8159          2351.975          54.30283</span></span>
<span><span class="co">#&gt; 43          482.4240          2894.544          22.17029</span></span>
<span><span class="co">#&gt; 44          341.9060          1367.624          44.84317</span></span>
<span><span class="co">#&gt; 45          363.7644          1818.822          30.17949</span></span>
<span><span class="co">#&gt; 46          252.3668          2271.302          42.81866</span></span>
<span><span class="co">#&gt; 47          213.8567          2566.281          52.59133</span></span>
<span><span class="co">#&gt; 48          479.9210          1919.684          25.29238</span></span>
<span><span class="co">#&gt; 50          207.7006          3115.509          53.61345</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, default (mean) s, default (var)</span></span>
<span><span class="co">#&gt; 14         -1.648184       0.07389930</span></span>
<span><span class="co">#&gt; 31         -1.723706       0.07783667</span></span>
<span><span class="co">#&gt; 32         -1.723706       0.07783667</span></span>
<span><span class="co">#&gt; 33         -2.074967       0.10089846</span></span>
<span><span class="co">#&gt; 36         -1.648184       0.07389930</span></span>
<span><span class="co">#&gt; 37         -1.576338       0.07043940</span></span>
<span><span class="co">#&gt; 39         -1.442005       0.06465620</span></span>
<span><span class="co">#&gt; 40         -1.978171       0.09367830</span></span>
<span><span class="co">#&gt; 41         -1.378841       0.06222167</span></span>
<span><span class="co">#&gt; 43         -1.442005       0.06465620</span></span>
<span><span class="co">#&gt; 44         -1.723706       0.07783667</span></span>
<span><span class="co">#&gt; 45         -1.378841       0.06222167</span></span>
<span><span class="co">#&gt; 46         -1.507734       0.06737895</span></span>
<span><span class="co">#&gt; 47         -1.507734       0.06737895</span></span>
<span><span class="co">#&gt; 48         -1.648184       0.07389930</span></span>
<span><span class="co">#&gt; 50         -1.648184       0.07389930</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PS_empirical_ests.html">PS_empirical_ests</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">fu</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="va">df</span><span class="op">$</span><span class="va">af</span><span class="op">)</span><span class="op">*</span><span class="va">df</span><span class="op">$</span><span class="va">n</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$n$"</span>, <span class="st">"$f$"</span>, <span class="st">"$a_f$"</span>, <span class="st">"a"</span>,</span>
<span>                       <span class="st">"$E[s ~|~ H_1]$"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print(xtable(df, digits = c(0,0,0,0,0,2)), booktabs = T, include.rownames = T, sanitize.text.function = function(x) {x}, floating = F, file = here("man", "tables", "P2.txt"))</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#ggsave(here("man", "figures", "P2.pdf"), height=9, width=14, units="cm")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="recruitment">Recruitment<a class="anchor" aria-label="anchor" href="#recruitment"></a>
</h2>
<p>Consider a standard two-arm parallel group trial with a continuous
endpoint and a t-test of the group means as the planned analysis.
Suppose that we are concerned about how well this trial will recruit,
and would like to estimate what the overall probability of a significant
result will be when we allow for the uncertainty in attained sample
size. We can approach this by using a hierarchical Poisson-Gamma model
of multi-site recruitment, with site setup times following a Poisson
process. To account for the uncertainty around the true parameter values
in that recruitment model we take a Bayesian view and give priors for
each parameter. This view then also extends to our outcome model, and we
place priors on the mean difference and the outcome standard deviation
too.</p>
<p>The design problem here is to choose both the number of recruiting
sites and the length of the recruitment period. The model parameters are
the hyperparameters of our prior distributions. We want to set a
constraint on the unconditional probability of a type II error under the
hypothesis of interest, and want to minimise the number of sites and the
recruitment period subject to that constraint. We want a simulation
function which returns the conditional power (conditioning on the
attained sample size and the parameters of the outcome model) for any
given design and hypothesis, and a deterministic function to return the
two objective functions.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtwilson.github.io/BOSSS/">BOSSS</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_rec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m<span class="op">=</span><span class="fl">20</span>, t<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, </span>
<span>                    <span class="va">hypothesis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">7</span>, b<span class="op">=</span><span class="fl">2</span>, c<span class="op">=</span><span class="fl">2</span>, d<span class="op">=</span><span class="fl">0.8</span>, </span>
<span>                                      f<span class="op">=</span><span class="fl">10</span>, g<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                      j<span class="op">=</span><span class="fl">0.3</span>, k<span class="op">=</span><span class="fl">0.3</span>, x<span class="op">=</span><span class="fl">1</span>, y<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="co"># m - total number of sites to be set up</span></span>
<span>  <span class="co"># t - time (in years) for recruitment</span></span>
<span>  <span class="co"># a, b - hyperparameters for rec mean (gamma)</span></span>
<span>  <span class="co"># c, d - hyperparameters for rec sd (gamma)</span></span>
<span>  <span class="co"># f, g - hyperparameters for eta (gamma)</span></span>
<span>  <span class="co"># j, k - hyperparameters for delta (normal)</span></span>
<span>  <span class="co"># x, y - hyperparameters for sigma (gamma)</span></span>
<span>  </span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">c</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Sample parameters from their priors</span></span>
<span>  <span class="co"># Recruitment rate</span></span>
<span>  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">a</span><span class="op">/</span><span class="va">b</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">b</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">a</span><span class="op">)</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">c</span><span class="op">/</span><span class="va">d</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">d</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">c</span><span class="op">)</span></span>
<span>  <span class="co"># Setup rate</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">f</span><span class="op">/</span><span class="va">g</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">g</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">f</span><span class="op">)</span></span>
<span>  <span class="co"># Treatment effect</span></span>
<span>  <span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">j</span>, <span class="va">k</span><span class="op">)</span></span>
<span>  <span class="co"># Outcome sd</span></span>
<span>  <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># True per year recruitment rates for each site</span></span>
<span>  <span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">alpha</span>, scale<span class="op">=</span><span class="va">beta</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Setup times</span></span>
<span>  <span class="va">setup_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># For each site, simulate number recruited by end</span></span>
<span>  <span class="va">rec_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">setup_ts</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">lambdas</span><span class="op">*</span><span class="va">rec_times</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Total recruited at final</span></span>
<span>  <span class="va">end_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ns</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Cap at target recruitment</span></span>
<span>  <span class="va">end_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">end_n</span>, <span class="fl">352</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Power at analysis</span></span>
<span>  <span class="va">pow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">end_n</span><span class="op">/</span><span class="fl">2</span>, delta <span class="op">=</span> <span class="va">delta</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">$</span><span class="va">power</span></span>
<span>  <span class="va">pow</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>pr_tII <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">pow</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">det_rec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m<span class="op">=</span><span class="fl">20</span>, t<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, </span>
<span>                    <span class="va">hypothesis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">7</span>, b<span class="op">=</span><span class="fl">2</span>, c<span class="op">=</span><span class="fl">2</span>, d<span class="op">=</span><span class="fl">0.8</span>, </span>
<span>                                      f<span class="op">=</span><span class="fl">10</span>, g<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                      j<span class="op">=</span><span class="fl">0.3</span>, k<span class="op">=</span><span class="fl">0.3</span>, x<span class="op">=</span><span class="fl">1</span>, y<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">c</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">hypothesis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, t <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># For example,</span></span>
<span><span class="fu">sim_rec</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now we set up the problem using the <code>BOSSS</code> helper
functions. We are going to look at designs with between 3 and 40 sites,
running from between 6 months and 5 years.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Problem specification</span></span>
<span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TII_ass"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pr_tII"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sites"</span>, <span class="st">"Time"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"t"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"alt"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span>sim_trial <span class="op">=</span> <span class="va">sim_rec</span>,</span>
<span>                      design_space <span class="op">=</span> <span class="va">design_space</span>,</span>
<span>                      objectives <span class="op">=</span> <span class="va">objectives</span>,</span>
<span>                      constraints <span class="op">=</span> <span class="va">constraints</span>,</span>
<span>                      det_func <span class="op">=</span> <span class="va">det_rec</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">543663</span><span class="op">)</span></span>
<span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fl">4</span></span>
<span></span>
<span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">ptm</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">ptm</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            m        t</span></span>
<span><span class="co">#&gt; 22  3.999997 1.584066</span></span>
<span><span class="co">#&gt; 26  5.995183 1.446359</span></span>
<span><span class="co">#&gt; 27  7.984760 1.314450</span></span>
<span><span class="co">#&gt; 28 11.738318 1.254927</span></span>
<span><span class="co">#&gt; 30  9.806715 1.266445</span></span>
<span><span class="co">#&gt; 32  6.938454 1.352378</span></span>
<span><span class="co">#&gt; 35  4.989575 1.491903</span></span>
<span><span class="co">#&gt; 49 10.523124 1.257338</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    m, default (mean) t, default (mean)</span></span>
<span><span class="co">#&gt; 22                 3          1.584066</span></span>
<span><span class="co">#&gt; 26                 5          1.446359</span></span>
<span><span class="co">#&gt; 27                 7          1.314450</span></span>
<span><span class="co">#&gt; 28                11          1.254927</span></span>
<span><span class="co">#&gt; 30                 9          1.266445</span></span>
<span><span class="co">#&gt; 32                 6          1.352378</span></span>
<span><span class="co">#&gt; 35                 4          1.491903</span></span>
<span><span class="co">#&gt; 49                10          1.257338</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    pr_tII, default (mean) pr_tII, default (var)</span></span>
<span><span class="co">#&gt; 22              0.3951991          1.915828e-05</span></span>
<span><span class="co">#&gt; 26              0.3811136          1.894814e-05</span></span>
<span><span class="co">#&gt; 27              0.3971696          1.950644e-05</span></span>
<span><span class="co">#&gt; 28              0.3985549          1.953344e-05</span></span>
<span><span class="co">#&gt; 30              0.3922023          1.943685e-05</span></span>
<span><span class="co">#&gt; 32              0.3996918          1.933841e-05</span></span>
<span><span class="co">#&gt; 35              0.3960625          1.929203e-05</span></span>
<span><span class="co">#&gt; 49              0.4034808          1.948699e-05</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PS_empirical_ests.html">PS_empirical_ests</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$m$"</span>, <span class="st">"$t$"</span>, <span class="st">"$E[p ~|~ H_1]$"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print(xtable(df, digits = c(0,0,2,2)), booktabs = T, include.rownames = T, sanitize.text.function = function(x) {x}, floating = F, file = here("man", "tables", "rec.txt"))</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Examples_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#ggsave(here("man", "figures", "rec.pdf"), height=9, width=14, units="cm")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Croft J, Ainsworth G, Corrigan N, et al. NIFTy: near-infrared
fluorescence (NIRF) imaging to prevent postsurgical hypoparathyroidism
(PoSH) after thyroid surgery—a phase II/III pragmatic, multicentre
randomised controlled trial protocol in patients undergoing a total or
completion thyroidectomy. <em>BMJ Open</em>, 15:e092422 (2025). <a href="https://doi.org/10.1136/bmjopen-2024-092422" class="external-link uri">https://doi.org/10.1136/bmjopen-2024-092422</a></p></li>
<li><p>Nixon, Jane et al. Pressure Relieving Support Surfaces for
Pressure Ulcer Prevention (PRESSURE 2): Clinical and Health Economic
Results of a Randomised Controlled Trial. <em>eClinicalMedicine</em>,
Volume 14, 42 - 52 (2019)</p></li>
<li><p>Smith IL, Nixon JE, Sharples L. Power and sample size for
multistate model analysis of longitudinal discrete outcomes in disease
prevention trials. <em>Statistics in Medicine</em>, 40: 1960–1971
(2021). <a href="https://doi.org/10.1002/sim.8882" class="external-link uri">https://doi.org/10.1002/sim.8882</a></p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Wilson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
