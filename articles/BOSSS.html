<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BOSSS • BOSSS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BOSSS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BOSSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/BOSSS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Examples.html">Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>BOSSS</h1>
            
      

      <div class="d-none name"><code>BOSSS.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtwilson.github.io/BOSSS/">BOSSS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/olafmersmann/mco" class="external-link">mco</a></span><span class="op">)</span></span></code></pre></div>
<!-- Note - a Twitter thread on power analysis had a couple of people mentioning the R package simr for power through simulation when using mixed models. So might be worth including that in one of our examples, to save people having to write their own simulation code? -->
<p>Every application of BOSSS follows the same set of steps:</p>
<ol style="list-style-type: decimal">
<li>Formally specify the problem and create a corresponding
<code>BOSSS_problem</code> object;</li>
<li>Create a <code>BOSSS_solution</code> object and initialise it;</li>
<li>Perform a number of iterations, each one updating and (hopefully)
improving the <code>BOSSS_solution</code> object;</li>
<li>Select a final design and run some diagnostics to check it is
valid.</li>
</ol>
<p>We will work through these steps here for an example problem:
designing a cluster randomised trial. For more illustrations, see the
“Examples” article.</p>
<div class="section level3">
<h3 id="problem">Problem<a class="anchor" aria-label="anchor" href="#problem"></a>
</h3>
<p>The first ingredient of a BOSSS problem is the simulation function.
The arguments of this function must first specify the <em>design
variables</em> which we want to vary in our problem, followed by the
<em>model parameters</em>. In this example we have two design variables
representing the number of clusters in each arm, and the number of
participants in each arm. The model parameters are the mean difference
in outcome between the control and experimental arms
(<code>beta_1</code>), the within-cluster variance (<code>var_e</code>),
and the between-cluster variance (<code>var_u</code>). Note that all of
these inputs require some defaults to be provided.</p>
<p>The other element of interface the simulation function must conform
to is in its return value, which should be a named vector of the
quantities who’s mean values we want to estimate using the Monte Carlo
method. Here, we have one such quantity: a boolean indicator of a
negative decision, <code>s</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_cRCT</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                     <span class="va">beta_1</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="va">var_e</span> <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">var_u</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>; <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">m</span><span class="op">)</span> </span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">m</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_u</span> <span class="op">+</span> <span class="va">var_e</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">+</span> <span class="va">x</span><span class="op">*</span><span class="va">beta_1</span></span>
<span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">x</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">x</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span>, alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.025</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># For example,</span></span>
<span><span class="fu">sim_cRCT</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     s </span></span>
<span><span class="co">#&gt; FALSE</span></span></code></pre></div>
<p>In our problem we are not just interested in the expected value of
<code>s</code>; we also want to minimise the number of clusters and the
number of participants, and to put an upper limit on the number of
participants per cluster. Since these are fixed quantities given any
design, we evaluate them in a separate deterministic function. This
should conform to the same principles as the simulation function, with
the same inputs, but allowing for different named outputs. Here, the
outputs are just <code>m</code>, and <code>N = n*m</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">det_cRCT</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                     <span class="va">beta_1</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="va">var_e</span> <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">var_u</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">m</span>, N <span class="op">=</span> <span class="va">n</span><span class="op">*</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span></code></pre></div>
<p>Next, we need to note the ranges of the design variables which we
plan to search over. We use the <code><a href="../reference/design_space.html">design_space()</a></code> function for
this, specifying the lower and upper limits of the design variables in
the order they appear as simulation function arguments:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_cRCT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_space</span></span>
<span><span class="co">#&gt;   name lower upper</span></span>
<span><span class="co">#&gt; 1    m     5    50</span></span>
<span><span class="co">#&gt; 2    n     5    40</span></span></code></pre></div>
<p>Note that the function automatically retrieves the names of the
design variables based on the order they take in the simulation
function.</p>
<p>We also need to specify the hypotheses which we’re planning to
simulate under, using the <code><a href="../reference/hypotheses.html">hypotheses()</a></code> function, again
specifying in the order that parameters appear as simulation function
argument. We only need one hypothesis here, the alternative, since we
will be estimating the type II error rate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hypotheses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypotheses.html">hypotheses</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         hyp_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                         sim <span class="op">=</span> <span class="va">sim_cRCT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypotheses</span></span>
<span><span class="co">#&gt;         alt</span></span>
<span><span class="co">#&gt; beta_1 0.30</span></span>
<span><span class="co">#&gt; var_e  0.95</span></span>
<span><span class="co">#&gt; var_u  0.05</span></span></code></pre></div>
<p>Constraints should be specified using the <code>constraints</code>
function. Each constraint should be named, and should be defined with
respect to a specific output and a specific hypothesis. It should have a
nominal maximum value, and a probability <code>delta</code> used to
judge if it is satisfied. Here, our constraint is that the mean of the
simulation output (i.e. the probability of a negative result) under the
<code>alt</code> hypothesis should be less than or equal to 0.2 with a
probability of at least 0.95. Finally, we note whether the constraint
output is binary or otherwise.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"con_tII"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span></span>
<span><span class="co">#&gt;      name out hyp nom delta binary</span></span>
<span><span class="co">#&gt; 1 con_tII   s alt 0.2  0.95   TRUE</span></span></code></pre></div>
<p>The final ingredient of the problem is the set of objectives we want
to minimise. Similar to constraints, objectives are tied to a specific
output and hypothesis. We also specify weights for each objective which
help guide the internal optimisation process, and note whether or not
the output for each objective is binary or continuous. For example, here
we want to minimise both the number of patients <code>N</code> and the
number of clusters <code>m</code>, with the latter carrying a weight of
100 times that of the former.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"m"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"m"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span></span>
<span><span class="co">#&gt;   name out hyp weight binary</span></span>
<span><span class="co">#&gt; 1    N   N alt      1  FALSE</span></span>
<span><span class="co">#&gt; 2    m   m alt     10  FALSE</span></span></code></pre></div>
<p>We now put this simulation function and set of data frames together
to create an object of class <code>BOSSS_problem</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span><span class="va">sim_cRCT</span>, <span class="va">design_space</span>, <span class="va">hypotheses</span>, <span class="va">objectives</span>, <span class="va">constraints</span>, det_func <span class="op">=</span> <span class="va">det_cRCT</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initialisation">Initialisation<a class="anchor" aria-label="anchor" href="#initialisation"></a>
</h3>
<p>Having set up the problem, we now need to create an initial solution
to it. This involves setting up a space-filling set of designs spanning
the design space (where <code>size</code> is the number of designs),
computing the Monte Carlo estimates of all the expectations we are
interested in at each of these designs (using <code>N</code> samples for
each evaluation), fitting Gaussian Process models to these estimates,
and then using those models to estimate the Pareto set and front:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9823579</span><span class="op">)</span></span>
<span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fl">3</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking simulation speed...</span></span>
<span><span class="co">#&gt; Initialisation will take approximately 5.198026 secs </span></span>
<span><span class="co">#&gt; Solution found</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        m      n</span></span>
<span><span class="co">#&gt; 3 16.250 31.250</span></span>
<span><span class="co">#&gt; 4 21.875 18.125</span></span>
<span><span class="co">#&gt; 6 33.125  9.375</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   N, alt (mean) m, alt (mean)</span></span>
<span><span class="co">#&gt; 3      507.8125        16.250</span></span>
<span><span class="co">#&gt; 4      396.4844        21.875</span></span>
<span><span class="co">#&gt; 6      310.5469        33.125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 3     -1.635087  0.007321908</span></span>
<span><span class="co">#&gt; 4     -1.570598  0.007014638</span></span>
<span><span class="co">#&gt; 6     -1.757202  0.007965536</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function will give a table of the Pareto set
with associated objective function values. The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
function will plot the Pareto front.</p>
</div>
<div class="section level3">
<h3 id="iteration">Iteration<a class="anchor" aria-label="anchor" href="#iteration"></a>
</h3>
<p>We can now start improving this solution by calling the
<code><a href="../reference/iterate.html">iterate()</a></code> function. Each call uses the fitted Gaussian
Process models to decide on the next design to be evaluated, computes
the Monte Carlo estimates at that point, and then updates the estimated
Pareto set and front.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fl">3</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           m         n</span></span>
<span><span class="co">#&gt; 3  16.25000 31.250000</span></span>
<span><span class="co">#&gt; 22 40.48122  6.069682</span></span>
<span><span class="co">#&gt; 23 26.78465 11.300130</span></span>
<span><span class="co">#&gt; 25 31.99851  8.458535</span></span>
<span><span class="co">#&gt; 26 23.15534 14.411708</span></span>
<span><span class="co">#&gt; 29 15.86167 33.573895</span></span>
<span><span class="co">#&gt; 30 20.48457 18.825180</span></span>
<span><span class="co">#&gt; 31 17.78064 24.595059</span></span>
<span><span class="co">#&gt; 32 17.20562 27.002041</span></span>
<span><span class="co">#&gt; 33 21.47477 16.377383</span></span>
<span><span class="co">#&gt; 34 19.07500 21.685123</span></span>
<span><span class="co">#&gt; 35 36.42695  7.000018</span></span>
<span><span class="co">#&gt; 36 43.64308  5.105722</span></span>
<span><span class="co">#&gt; 37 15.65390 34.201300</span></span>
<span><span class="co">#&gt; 38 43.37548  5.165664</span></span>
<span><span class="co">#&gt; 40 28.34157 10.180265</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    N, alt (mean) m, alt (mean)</span></span>
<span><span class="co">#&gt; 3       507.8125      16.25000</span></span>
<span><span class="co">#&gt; 22      245.7081      40.48122</span></span>
<span><span class="co">#&gt; 23      302.6700      26.78465</span></span>
<span><span class="co">#&gt; 25      270.6605      31.99851</span></span>
<span><span class="co">#&gt; 26      333.7080      23.15534</span></span>
<span><span class="co">#&gt; 29      532.5381      15.86167</span></span>
<span><span class="co">#&gt; 30      385.6257      20.48457</span></span>
<span><span class="co">#&gt; 31      437.3160      17.78064</span></span>
<span><span class="co">#&gt; 32      464.5869      17.20562</span></span>
<span><span class="co">#&gt; 33      351.7005      21.47477</span></span>
<span><span class="co">#&gt; 34      413.6437      19.07500</span></span>
<span><span class="co">#&gt; 35      254.9893      36.42695</span></span>
<span><span class="co">#&gt; 36      222.8294      43.64308</span></span>
<span><span class="co">#&gt; 37      535.3836      15.65390</span></span>
<span><span class="co">#&gt; 38      224.0632      43.37548</span></span>
<span><span class="co">#&gt; 40      288.5247      28.34157</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 3      -1.635087  0.007321908</span></span>
<span><span class="co">#&gt; 22     -1.577629  0.007047103</span></span>
<span><span class="co">#&gt; 23     -1.591789  0.007113245</span></span>
<span><span class="co">#&gt; 25     -1.318214  0.006001954</span></span>
<span><span class="co">#&gt; 26     -1.442726  0.006465914</span></span>
<span><span class="co">#&gt; 29     -1.502002  0.006710669</span></span>
<span><span class="co">#&gt; 30     -1.613281  0.007215600</span></span>
<span><span class="co">#&gt; 31     -1.330260  0.006044017</span></span>
<span><span class="co">#&gt; 32     -1.515481  0.006768604</span></span>
<span><span class="co">#&gt; 33     -1.455710  0.006518154</span></span>
<span><span class="co">#&gt; 34     -1.570598  0.007014638</span></span>
<span><span class="co">#&gt; 35     -1.765190  0.008010631</span></span>
<span><span class="co">#&gt; 36     -1.410713  0.006340311</span></span>
<span><span class="co">#&gt; 37     -1.529077  0.006827921</span></span>
<span><span class="co">#&gt; 38     -1.481997  0.006626261</span></span>
<span><span class="co">#&gt; 40     -1.535920  0.006858112</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>We can compare the initial and final approximations to the Pareto
front to the actual front since, for this simple example, we can
calculate power analytically:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">50</span>,</span>
<span>                  n <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">m</span><span class="op">*</span><span class="va">df</span><span class="op">$</span><span class="va">n</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">clust_var</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="op">+</span> <span class="fl">0.95</span><span class="op">/</span><span class="va">df</span><span class="op">$</span><span class="va">n</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">pow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">m</span>, delta <span class="op">=</span> <span class="fl">0.3</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">clust_var</span><span class="op">)</span>,</span>
<span>                       alternative <span class="op">=</span> <span class="st">"one.sided"</span>, sig.level <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span><span class="op">$</span><span class="va">power</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">pow</span> <span class="op">&gt;=</span> <span class="fl">0.8</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"N"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mco/man/paretoFront.html" class="external-link">paretoFilter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="st">"True"</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">21</span>, <span class="fl">33</span>,</span>
<span>                                 <span class="fl">25</span>, <span class="fl">32</span>, <span class="fl">18</span>, <span class="fl">22</span>, <span class="fl">19</span>, <span class="fl">28</span>, <span class="fl">17</span>, <span class="fl">36</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">39</span><span class="op">)</span>,</span>
<span>                           N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span><span class="op">*</span><span class="fl">31</span>, <span class="fl">21</span><span class="op">*</span><span class="fl">18</span>, <span class="fl">33</span><span class="op">*</span><span class="fl">9</span>,</span>
<span>                                 <span class="fl">25</span><span class="op">*</span><span class="fl">12</span>, <span class="fl">32</span><span class="op">*</span><span class="fl">8</span>, <span class="fl">18</span><span class="op">*</span><span class="fl">24</span>, <span class="fl">22</span><span class="op">*</span><span class="fl">15</span>, <span class="fl">19</span><span class="op">*</span><span class="fl">20</span>, <span class="fl">28</span><span class="op">*</span><span class="fl">10</span>, <span class="fl">17</span><span class="op">*</span><span class="fl">26</span>, <span class="fl">36</span><span class="op">*</span><span class="fl">7</span>, <span class="fl">15</span><span class="op">*</span><span class="fl">31</span>, <span class="fl">20</span><span class="op">*</span><span class="fl">18</span>, <span class="fl">39</span><span class="op">*</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>                           t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Initial"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Final"</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add ends of steps</span></span>
<span><span class="va">df2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">43</span>, <span class="fl">43</span><span class="op">)</span>,</span>
<span>                          N<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">297</span>, <span class="fl">234</span><span class="op">)</span>,</span>
<span>                          t<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Initial"</span>, <span class="st">"Final"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="va">df</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>                         N<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">546</span>, <span class="fl">546</span><span class="op">)</span>,</span>
<span>                         t<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Initial"</span>, <span class="st">"Final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">m</span>, colour <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Total sample size per arm, N"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Number of clusters per arm, m"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#EF476F"</span>, <span class="st">"#FFD166"</span>, <span class="st">"#06D6A0"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#ggsave(here("man", "figures", "cRCT_fronts.pdf"), height=9, width=14, units="cm")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<p>To check the GP models are giving sensible predictions, we can choose
a specific design and then plot the predictions for each model along the
range of each design variable.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pick a specific design from the Pareto set</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/diag_plots.html">diag_plots</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span></code></pre>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
<p>We can also get the predicted values and 95% credible intervals for
each point we have evaluated, contrasting these with the empirical MC
estimate and interval. This will return a data frame for each of the
models, named according to the output-hypothesis combination which
defines it. We highlight with a <code>*</code> any points where the two
intervals do not overlap.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diag_predictions.html">diag_predictions</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Output: s, hypothesis: alt`</span></span>
<span><span class="co">#&gt;           m         n     MC_mean       MC_l95      MC_u95      p_mean</span></span>
<span><span class="co">#&gt; 1  27.50000 22.500000 0.060175930 0.0582463424 0.062165221 0.056957904</span></span>
<span><span class="co">#&gt; 2  38.75000 13.750000 0.024190324 0.0223066149 0.026228837 0.036380055</span></span>
<span><span class="co">#&gt; 3  16.25000 31.250000 0.163134746 0.1611850248 0.165103410 0.179776337</span></span>
<span><span class="co">#&gt; 4  21.87500 18.125000 0.172131148 0.1701807896 0.174099168 0.159851517</span></span>
<span><span class="co">#&gt; 5  44.37500 35.625000 0.002199120 0.0009016767 0.005353483 0.001586608</span></span>
<span><span class="co">#&gt; 6  33.12500  9.375000 0.147141144 0.1451927364 0.149111136 0.142194634</span></span>
<span><span class="co">#&gt; 7  10.62500 26.875000 0.429028389 0.4270703303 0.430988671 0.426962209</span></span>
<span><span class="co">#&gt; 8  13.43750 15.937500 0.411035586 0.4090778258 0.412996167 0.404775655</span></span>
<span><span class="co">#&gt; 9  35.93750 33.437500 0.005197921 0.0035644644 0.007574237 0.005973989</span></span>
<span><span class="co">#&gt; 10 47.18750  7.187500 0.094162335 0.0922213338 0.096139862 0.095093667</span></span>
<span><span class="co">#&gt; 11 24.68750 24.687500 0.068172731 0.0662394513 0.070158196 0.072137616</span></span>
<span><span class="co">#&gt; 12 19.06250 11.562500 0.310075970 0.3081202048 0.312038550 0.318630782</span></span>
<span><span class="co">#&gt; 13 41.56250 29.062500 0.002199120 0.0009016767 0.005353483 0.003487009</span></span>
<span><span class="co">#&gt; 14 30.31250 20.312500 0.052179128 0.0502543456 0.054173427 0.046383132</span></span>
<span><span class="co">#&gt; 15  7.81250 37.812500 0.556977209 0.5550171525 0.558935493 0.552228502</span></span>
<span><span class="co">#&gt; 16  9.21875 21.406250 0.526989204 0.5250296185 0.528947959 0.529431473</span></span>
<span><span class="co">#&gt; 17 31.71875 38.906250 0.011195522 0.0093966506 0.013334129 0.011786138</span></span>
<span><span class="co">#&gt; 18 42.96875 12.656250 0.031187525 0.0292867903 0.033207399 0.030595545</span></span>
<span><span class="co">#&gt; 19 20.46875 30.156250 0.110155938 0.1082119693 0.112130437 0.097222981</span></span>
<span><span class="co">#&gt; 20 26.09375  8.281250 0.287085166 0.2851299855 0.289048332 0.288050484</span></span>
<span><span class="co">#&gt; 21 38.46983  5.000000 0.254098361 0.2521441651 0.256062516 0.245954606</span></span>
<span><span class="co">#&gt; 22 40.48122  6.069682 0.171131547 0.1691812571 0.173099636 0.171932284</span></span>
<span><span class="co">#&gt; 23 26.78465 11.300130 0.169132347 0.1671821942 0.171100575 0.181053083</span></span>
<span><span class="co">#&gt; 24 45.10551  5.045737 0.188124750 0.1861734031 0.190091773 0.183550940</span></span>
<span><span class="co">#&gt; 25 31.99851  8.458535 0.211115554 0.2091630314 0.213081392 0.185448055</span></span>
<span><span class="co">#&gt; 26 23.15534 14.411708 0.191123551 0.1891720354 0.193090403 0.181217014</span></span>
<span><span class="co">#&gt; 27 32.94188  8.272720 0.182127149 0.1801761539 0.184094526 0.178292303</span></span>
<span><span class="co">#&gt; 28 18.79809 24.038611 0.159136345 0.1571869290 0.161105317 0.169276494</span></span>
<span><span class="co">#&gt; 29 15.86167 33.573895 0.182127149 0.1801761539 0.184094526 0.182665565</span></span>
<span><span class="co">#&gt; 30 20.48457 18.825180 0.166133547 0.1641836058 0.168101988 0.179288540</span></span>
<span><span class="co">#&gt; 31 17.78064 24.595059 0.209116353 0.2071639238 0.211082285 0.188682935</span></span>
<span><span class="co">#&gt; 32 17.20562 27.002041 0.180127949 0.1781770757 0.182095449 0.183209577</span></span>
<span><span class="co">#&gt; 33 21.47477 16.377383 0.189124350 0.1871729467 0.191091316 0.185805282</span></span>
<span><span class="co">#&gt; 34 19.07500 21.685123 0.172131148 0.1701807896 0.174099168 0.183041389</span></span>
<span><span class="co">#&gt; 35 36.42695  7.000018 0.146141543 0.1441932276 0.148111628 0.178237873</span></span>
<span><span class="co">#&gt; 36 43.64308  5.105722 0.196121551 0.1941697667 0.198088133 0.190057094</span></span>
<span><span class="co">#&gt; 37 15.65390 34.201300 0.178128749 0.1761780001 0.180096375 0.187843532</span></span>
<span><span class="co">#&gt; 38 43.37548  5.165664 0.185125950 0.1831747758 0.187093147 0.189051999</span></span>
<span><span class="co">#&gt; 39 15.49021 34.178806 0.199120352 0.1971684114 0.201086776 0.192789817</span></span>
<span><span class="co">#&gt; 40 28.34157 10.180265 0.177129148 0.1751784633 0.179096839 0.186108926</span></span>
<span><span class="co">#&gt;           p_l95       p_u95 no_overlap</span></span>
<span><span class="co">#&gt; 1  0.0504899820 0.064198366           </span></span>
<span><span class="co">#&gt; 2  0.0303723465 0.043522761          *</span></span>
<span><span class="co">#&gt; 3  0.1685700668 0.191555946          *</span></span>
<span><span class="co">#&gt; 4  0.1498382099 0.170399867           </span></span>
<span><span class="co">#&gt; 5  0.0007426893 0.003386224           </span></span>
<span><span class="co">#&gt; 6  0.1326243685 0.152334210           </span></span>
<span><span class="co">#&gt; 7  0.4034164409 0.450843698           </span></span>
<span><span class="co">#&gt; 8  0.3814426065 0.428547144           </span></span>
<span><span class="co">#&gt; 9  0.0040846020 0.008729677           </span></span>
<span><span class="co">#&gt; 10 0.0822898201 0.109651686           </span></span>
<span><span class="co">#&gt; 11 0.0649001650 0.080113016           </span></span>
<span><span class="co">#&gt; 12 0.2973662995 0.340678592           </span></span>
<span><span class="co">#&gt; 13 0.0020974537 0.005791796           </span></span>
<span><span class="co">#&gt; 14 0.0403302792 0.053293962           </span></span>
<span><span class="co">#&gt; 15 0.5212681015 0.582789205           </span></span>
<span><span class="co">#&gt; 16 0.5032728008 0.555429464           </span></span>
<span><span class="co">#&gt; 17 0.0074397908 0.018623992           </span></span>
<span><span class="co">#&gt; 18 0.0248144243 0.037671489           </span></span>
<span><span class="co">#&gt; 19 0.0884632136 0.106748573          *</span></span>
<span><span class="co">#&gt; 20 0.2676806489 0.309315688           </span></span>
<span><span class="co">#&gt; 21 0.2286040497 0.264171060           </span></span>
<span><span class="co">#&gt; 22 0.1616848682 0.182687635           </span></span>
<span><span class="co">#&gt; 23 0.1703657257 0.192255514           </span></span>
<span><span class="co">#&gt; 24 0.1699502877 0.197980407           </span></span>
<span><span class="co">#&gt; 25 0.1752688085 0.196077936          *</span></span>
<span><span class="co">#&gt; 26 0.1700459614 0.192951327           </span></span>
<span><span class="co">#&gt; 27 0.1682486228 0.188799450           </span></span>
<span><span class="co">#&gt; 28 0.1591501230 0.179909324           </span></span>
<span><span class="co">#&gt; 29 0.1711977832 0.194721045           </span></span>
<span><span class="co">#&gt; 30 0.1684772717 0.190634520          *</span></span>
<span><span class="co">#&gt; 31 0.1776039931 0.200284672          *</span></span>
<span><span class="co">#&gt; 32 0.1723795169 0.194560100           </span></span>
<span><span class="co">#&gt; 33 0.1747817318 0.197357815           </span></span>
<span><span class="co">#&gt; 34 0.1718886037 0.194747631           </span></span>
<span><span class="co">#&gt; 35 0.1675825084 0.189416571          *</span></span>
<span><span class="co">#&gt; 36 0.1784924349 0.202186625           </span></span>
<span><span class="co">#&gt; 37 0.1754993903 0.200844424           </span></span>
<span><span class="co">#&gt; 38 0.1778435573 0.200794320           </span></span>
<span><span class="co">#&gt; 39 0.1803004918 0.205926932           </span></span>
<span><span class="co">#&gt; 40 0.1757413199 0.196942018</span></span></code></pre></div>
<p>If things aren’t looking too good, it may indicate that we need more
points in our initial evaluations, or more simulations at each of those
points. We can do that via <code><a href="../reference/extend_initial.html">extend_initial()</a></code>. For example,
suppose we want to add an extra 500 simulations to our initial
points:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_initial.html">extend_initial</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span>, extra_N <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the first threee designs; the empirical and predicted estimates will have changed</span></span>
<span><span class="fu"><a href="../reference/diag_predictions.html">diag_predictions</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;       m     n    MC_mean     MC_l95     MC_u95     p_mean      p_l95      p_u95</span></span>
<span><span class="co">#&gt; 1 27.50 22.50 0.05811784 0.05682523 0.05943799 0.05602840 0.05050379 0.06211780</span></span>
<span><span class="co">#&gt; 2 38.75 13.75 0.02679286 0.02551707 0.02813058 0.03601014 0.03091769 0.04190509</span></span>
<span><span class="co">#&gt; 3 16.25 31.25 0.17342042 0.17211801 0.17473061 0.18109913 0.17081373 0.19186055</span></span>
<span><span class="co">#&gt;   no_overlap</span></span>
<span><span class="co">#&gt; 1           </span></span>
<span><span class="co">#&gt; 2          *</span></span>
<span><span class="co">#&gt; 3</span></span></code></pre></div>
<p>Or, we could add another 10 points:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_initial.html">extend_initial</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span>, extra_points <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the added designs, which go to the top of the table</span></span>
<span><span class="fu"><a href="../reference/diag_predictions.html">diag_predictions</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;           m        n     MC_mean      MC_l95      MC_u95      p_mean</span></span>
<span><span class="co">#&gt; 21 48.59375 25.78125 0.002132765 0.001155577 0.003933034 0.001881998</span></span>
<span><span class="co">#&gt; 22 37.34375 17.03125 0.030125300 0.028846092 0.031459398 0.027013738</span></span>
<span><span class="co">#&gt; 23 14.84375 34.53125 0.212076780 0.210773425 0.213386014 0.212351339</span></span>
<span><span class="co">#&gt; 24 12.03125 10.46875 0.537989869 0.536683317 0.539295900 0.533638118</span></span>
<span><span class="co">#&gt; 25 34.53125 27.96875 0.010797121 0.009566020 0.012184709 0.011169427</span></span>
<span><span class="co">#&gt; 26 45.78125 19.21875 0.006798187 0.005609065 0.008237316 0.007098252</span></span>
<span><span class="co">#&gt; 27 23.28125 36.71875 0.046787523 0.045498433 0.048111296 0.048960723</span></span>
<span><span class="co">#&gt; 28 17.65625 14.84375 0.296720874 0.295416245 0.298028829 0.291551982</span></span>
<span><span class="co">#&gt; 29 40.15625 32.34375 0.002799254 0.001754934 0.004462244 0.002933357</span></span>
<span><span class="co">#&gt; 30 28.90625  6.09375 0.318715009 0.317410142 0.320022726 0.326801725</span></span>
<span><span class="co">#&gt;          p_l95       p_u95 no_overlap</span></span>
<span><span class="co">#&gt; 21 0.001169672 0.003026812           </span></span>
<span><span class="co">#&gt; 22 0.023649467 0.030841479           </span></span>
<span><span class="co">#&gt; 23 0.201705027 0.223402325           </span></span>
<span><span class="co">#&gt; 24 0.510478937 0.556653212           </span></span>
<span><span class="co">#&gt; 25 0.009271143 0.013451112           </span></span>
<span><span class="co">#&gt; 26 0.005422669 0.009286749           </span></span>
<span><span class="co">#&gt; 27 0.042203161 0.056736211           </span></span>
<span><span class="co">#&gt; 28 0.279907439 0.303476795           </span></span>
<span><span class="co">#&gt; 29 0.002104517 0.004087291           </span></span>
<span><span class="co">#&gt; 30 0.308788144 0.345341131</span></span></code></pre></div>
<p>Once we are happy with our solution and have chosen a specific design
from the Pareto set, we might want to double check that point by running
a large number of simulations at it.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_check_point.html">diag_check_point</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span>, N<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Model 1 prediction interval: [0.175, 0.193]</span></span>
<span><span class="co">#&gt; Model 1 empirical interval: [0.175, 0.176]</span></span></code></pre></div>
<p>If we decide we want to run more simulations at the same point, we
can pass the previous results in so they are built upon.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_check_point.html">diag_check_point</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span>, N<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">4</span>, <span class="va">r</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Model 1 prediction interval: [0.175, 0.193]</span></span>
<span><span class="co">#&gt; Model 1 empirical interval: [0.175, 0.176]</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Wilson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
