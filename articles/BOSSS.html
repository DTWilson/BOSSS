<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BOSSS • BOSSS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BOSSS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BOSSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/BOSSS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Examples.html">Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>BOSSS</h1>
            
      

      <div class="d-none name"><code>BOSSS.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtwilson.github.io/BOSSS/">BOSSS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/olafmersmann/mco" class="external-link">mco</a></span><span class="op">)</span></span></code></pre></div>
<!-- Note - a Twitter thread on power analysis had a couple of people mentioning the R package simr for power through simulation when using mixed models. So might be worth including that in one of our examples, to save people having to write their own simulation code? -->
<p>Every application of BOSSS follows the same set of steps:</p>
<ol style="list-style-type: decimal">
<li>Formally specify the problem and create a corresponding
<code>BOSSS_problem</code> object;</li>
<li>Create a <code>BOSSS_solution</code> object and initialise it;</li>
<li>Perform a number of iterations, each one updating and (hopefully)
improving the <code>BOSSS_solution</code> object;</li>
<li>Select a final design and run some diagnostics to check it is
valid.</li>
</ol>
<p>We will work through these steps here for an example problem:
designing a cluster randomised trial, as discussed in Section 2 of the
manuscript associated with the package. For more illustrations, see the
article.</p>
<div class="section level3">
<h3 id="problem">Problem<a class="anchor" aria-label="anchor" href="#problem"></a>
</h3>
<p>The first ingredient of a BOSSS problem is the simulation function.
The arguments of this function must first specify the <em>design
variables</em> which we want to vary in our problem, followed by the
<em>model parameters</em>. In this example we have two design variables
representing the number of clusters in each arm, and the number of
participants in each arm. The model parameters are the mean difference
in outcome between the control and experimental arms
(<code>beta_1</code>), the within-cluster variance (<code>var_e</code>),
and the between-cluster variance (<code>var_u</code>). Note that all of
these inputs require some defaults to be provided.</p>
<p>The other element of interface the simulation function must conform
to is in its return value, which should be a named vector of the
quantities who’s mean values we want to estimate using the Monte Carlo
method. Here, we have one such quantity: a boolean indicator of a
negative decision, <code>s</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_cRCT</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                     <span class="va">beta_1</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="va">var_e</span> <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">var_u</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>; <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">m</span><span class="op">)</span> </span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">m</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_u</span> <span class="op">+</span> <span class="va">var_e</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">+</span> <span class="va">x</span><span class="op">*</span><span class="va">beta_1</span></span>
<span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">x</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">x</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span>, alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.025</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># For example,</span></span>
<span><span class="fu">sim_cRCT</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     s </span></span>
<span><span class="co">#&gt; FALSE</span></span></code></pre></div>
<p>In our problem we are not just interested in the expected value of
<code>s</code>; we also want to minimise the number of clusters and the
number of participants. Since these are fixed quantities given any
design, we evaluate them in a separate deterministic function. This
should conform to the same principles as the simulation function, with
the same inputs, but allowing for different named outputs. Here, the
outputs are just <code>m</code>, and <code>N = n*m</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">det_cRCT</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                     <span class="va">beta_1</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="va">var_e</span> <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">var_u</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span></code></pre></div>
<p>Next, we need to note the ranges of the design variables which we
plan to search over. We use the <code><a href="../reference/design_space.html">design_space()</a></code> function for
this, specifying the lower and upper limits of the design variables in
the order they appear as simulation function arguments:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_cRCT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_space</span></span>
<span><span class="co">#&gt;   name lower upper</span></span>
<span><span class="co">#&gt; 1    m    10    50</span></span>
<span><span class="co">#&gt; 2    n     5    20</span></span></code></pre></div>
<p>Note that the function automatically retrieves the names of the
design variables based on the order they take in the simulation
function.</p>
<p>We also need to specify the hypotheses which we’re planning to
simulate under, using the <code><a href="../reference/hypotheses.html">hypotheses()</a></code> function, again
specifying in the order that parameters appear as simulation function
argument. We only need one hypothesis here, the alternative, since we
will be estimating the type II error rate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hypotheses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypotheses.html">hypotheses</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         hyp_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                         sim <span class="op">=</span> <span class="va">sim_cRCT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypotheses</span></span>
<span><span class="co">#&gt;         alt</span></span>
<span><span class="co">#&gt; beta_1 0.30</span></span>
<span><span class="co">#&gt; var_e  0.95</span></span>
<span><span class="co">#&gt; var_u  0.05</span></span></code></pre></div>
<p>Constraints should be specified using the <code>constraints</code>
function. Each constraint should be named, and should be defined with
respect to a specific output and a specific hypothesis. It should have a
nominal maximum value, and a probability <code>delta</code> used to
judge if it is satisfied. Here, our constraint is that the mean of the
simulation output (i.e. the probability of a negative result) under the
<code>alt</code> hypothesis should be less than or equal to 0.2 with a
probability of at least 0.95. Finally, we note whether the constraint
output is binary or otherwise.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"con_tII"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span></span>
<span><span class="co">#&gt;      name out hyp nom delta binary</span></span>
<span><span class="co">#&gt; 1 con_tII   s alt 0.2  0.95   TRUE</span></span></code></pre></div>
<p>The final ingredient of the problem is the set of objectives we want
to minimise. Similar to constraints, objectives are tied to a specific
output and hypothesis. We also specify weights for each objective which
help guide the internal optimisation process, and note whether or not
the output for each objective is binary or continuous. For example, here
we want to minimise both the number of patients <code>N</code> and the
number of clusters <code>m</code>, with the latter carrying a weight of
100 times that of the former.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"m"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"m"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span></span>
<span><span class="co">#&gt;   name out hyp weight binary</span></span>
<span><span class="co">#&gt; 1    N   N alt      1  FALSE</span></span>
<span><span class="co">#&gt; 2    m   m alt     10  FALSE</span></span></code></pre></div>
<p>We now put this simulation function and set of data frames together
to create an object of class <code>BOSSS_problem</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span><span class="va">sim_cRCT</span>, <span class="va">design_space</span>, <span class="va">hypotheses</span>, <span class="va">objectives</span>, <span class="va">constraints</span>, det_func <span class="op">=</span> <span class="va">det_cRCT</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initialisation">Initialisation<a class="anchor" aria-label="anchor" href="#initialisation"></a>
</h3>
<p>Having set up the problem, we now need to create an initial solution
to it. This involves setting up a space-filling set of designs spanning
the design space (where <code>size</code> is the number of designs),
computing the Monte Carlo estimates of all the expectations we are
interested in at each of these designs (using <code>N</code> samples for
each evaluation), fitting Gaussian Process models to these estimates,
and then using those models to estimate the Pareto set and front:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9823579</span><span class="op">)</span></span>
<span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking simulation speed...</span></span>
<span><span class="co">#&gt; Initialisation will take approximately 0.592622 secs </span></span>
<span><span class="co">#&gt; Solution found</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        m        n</span></span>
<span><span class="co">#&gt; 2  40.00  8.75000</span></span>
<span><span class="co">#&gt; 19 23.75 15.78125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    N, alt (mean) m, alt (mean)</span></span>
<span><span class="co">#&gt; 2            320            40</span></span>
<span><span class="co">#&gt; 19           345            23</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 2      -2.419826    0.1333284</span></span>
<span><span class="co">#&gt; 19     -1.442005    0.0646562</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol_init</span> <span class="op">&lt;-</span> <span class="va">sol</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function will give a table of the Pareto set
with associated objective function values. The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
function will plot the Pareto front.</p>
</div>
<div class="section level3">
<h3 id="iteration">Iteration<a class="anchor" aria-label="anchor" href="#iteration"></a>
</h3>
<p>We can now start improving this solution by calling the
<code><a href="../reference/iterate.html">iterate()</a></code> function. Each call uses the fitted Gaussian
Process models to decide on the next design to be evaluated, computes
the Monte Carlo estimates at that point, and then updates the estimated
Pareto set and front.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           m         n</span></span>
<span><span class="co">#&gt; 19 23.75000 15.781250</span></span>
<span><span class="co">#&gt; 23 26.99935 11.997542</span></span>
<span><span class="co">#&gt; 26 20.99972 19.999855</span></span>
<span><span class="co">#&gt; 29 24.97515 13.999811</span></span>
<span><span class="co">#&gt; 31 32.99968  8.999911</span></span>
<span><span class="co">#&gt; 33 27.95746 10.990021</span></span>
<span><span class="co">#&gt; 34 36.93869  7.994242</span></span>
<span><span class="co">#&gt; 36 22.97379 16.990697</span></span>
<span><span class="co">#&gt; 40 21.99923 17.975259</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    N, alt (mean) m, alt (mean)</span></span>
<span><span class="co">#&gt; 19           345            23</span></span>
<span><span class="co">#&gt; 23           286            26</span></span>
<span><span class="co">#&gt; 26           380            20</span></span>
<span><span class="co">#&gt; 29           312            24</span></span>
<span><span class="co">#&gt; 31           256            32</span></span>
<span><span class="co">#&gt; 33           270            27</span></span>
<span><span class="co">#&gt; 34           252            36</span></span>
<span><span class="co">#&gt; 36           352            22</span></span>
<span><span class="co">#&gt; 40           357            21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 19     -1.442005   0.06465620</span></span>
<span><span class="co">#&gt; 23     -1.507734   0.06737895</span></span>
<span><span class="co">#&gt; 26     -1.259177   0.05806410</span></span>
<span><span class="co">#&gt; 29     -1.648184   0.07389930</span></span>
<span><span class="co">#&gt; 31     -1.507734   0.06737895</span></span>
<span><span class="co">#&gt; 33     -1.317975   0.06003526</span></span>
<span><span class="co">#&gt; 34     -1.202247   0.05628104</span></span>
<span><span class="co">#&gt; 36     -1.576338   0.07043940</span></span>
<span><span class="co">#&gt; 40     -1.978171   0.09367830</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol_final</span> <span class="op">&lt;-</span> <span class="va">sol</span></span></code></pre></div>
<p>We can compare the initial and final approximations to the Pareto
front to the actual front since, for this simple example, we can
calculate power analytically:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">50</span>,</span>
<span>                  n <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">m</span><span class="op">*</span><span class="va">df</span><span class="op">$</span><span class="va">n</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">clust_var</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="op">+</span> <span class="fl">0.95</span><span class="op">/</span><span class="va">df</span><span class="op">$</span><span class="va">n</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">pow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">m</span>, delta <span class="op">=</span> <span class="fl">0.3</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">clust_var</span><span class="op">)</span>,</span>
<span>                       alternative <span class="op">=</span> <span class="st">"one.sided"</span>, sig.level <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span><span class="op">$</span><span class="va">power</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">pow</span> <span class="op">&gt;=</span> <span class="fl">0.8</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"n"</span>, <span class="st">"N"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mco/man/paretoFront.html" class="external-link">paretoFilter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="st">"True"</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">sol_init</span><span class="op">$</span><span class="va">p_set</span><span class="op">$</span><span class="va">m</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">sol_final</span><span class="op">$</span><span class="va">p_set</span><span class="op">$</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">sol_init</span><span class="op">$</span><span class="va">p_set</span><span class="op">$</span><span class="va">n</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">sol_final</span><span class="op">$</span><span class="va">p_set</span><span class="op">$</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">sol_init</span><span class="op">$</span><span class="va">p_set</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">sol_final</span><span class="op">$</span><span class="va">p_set</span><span class="op">$</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Initial"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sol_init</span><span class="op">$</span><span class="va">p_set</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Final"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sol_final</span><span class="op">$</span><span class="va">p_set</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add ends of steps</span></span>
<span><span class="va">df2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">m</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                          N<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"Initial"</span>, <span class="st">"N"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"True"</span>, <span class="st">"N"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"Final"</span>, <span class="st">"N"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          t<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Initial"</span>, <span class="st">"True"</span>, <span class="st">"Final"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"N"</span>, <span class="st">"t"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"Initial"</span>, <span class="st">"m"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"True"</span>, <span class="st">"m"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"Final"</span>, <span class="st">"m"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         N<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         t<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Initial"</span>, <span class="st">"True"</span>, <span class="st">"Final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">m</span>, colour <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Total sample size per arm, N"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Number of clusters per arm, m"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#EF476F"</span>, <span class="st">"#FFD166"</span>, <span class="st">"#06D6A0"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#ggsave(here("man", "figures", "cRCT_fronts.pdf"), height=9, width=14, units="cm")</span></span>
<span></span>
<span><span class="co"># Tabulate results</span></span>
<span><span class="va">df_init</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"Initial"</span>,<span class="op">]</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PS_empirical_ests.html">PS_empirical_ests</a></span><span class="op">(</span><span class="va">sol_init</span>, <span class="va">prob</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">df_init</span><span class="op">$</span><span class="va">pow</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_init</span> <span class="op">&lt;-</span> <span class="va">df_init</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df_init</span><span class="op">$</span><span class="va">m</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df_init</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$m$"</span>, <span class="st">"$n$"</span>, <span class="st">"$N$"</span>, <span class="st">"power"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print(xtable(df_init, digits = c(0,0,0,0,2)), booktabs = T, include.rownames = F, sanitize.text.function = function(x) {x}, floating = F, file = here("man", "tables", "cRCT_init.txt"))</span></span>
<span></span>
<span><span class="va">df_final</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">==</span> <span class="st">"Final"</span>,<span class="op">]</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PS_empirical_ests.html">PS_empirical_ests</a></span><span class="op">(</span><span class="va">sol_final</span>, <span class="va">prob</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">df_final</span><span class="op">$</span><span class="va">pow</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_final</span> <span class="op">&lt;-</span> <span class="va">df_final</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df_final</span><span class="op">$</span><span class="va">m</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df_final</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$m$"</span>, <span class="st">"$n$"</span>, <span class="st">"$N$"</span>, <span class="st">"power"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print(xtable(df_final, digits = c(0,0,0,0,2)), booktabs = T, include.rownames = F, sanitize.text.function = function(x) {x}, floating = F, file = here("man", "tables", "cRCT_final.txt"))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<p>To check the GP models are giving sensible predictions, we can choose
a specific design and then plot the predictions for each model along the
range of each design variable.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pick a specific design from the Pareto set</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_plots.html">diag_plots</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#ggsave(here("man", "figures", "cRCT_diag_m.pdf"), height=8, width=8, units="cm")</span></span>
<span></span>
<span><span class="va">ps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#ggsave(here("man", "figures", "cRCT_diag_n.pdf"), height=8, width=8, units="cm")</span></span></code></pre></div>
<p>We can also get the predicted values and 95% credible intervals for
each point we have evaluated, contrasting these with the empirical MC
estimate and interval. This will return a data frame for each of the
models, named according to the output-hypothesis combination which
defines it. We highlight with a <code>*</code> any points where the two
intervals do not overlap.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diag_predictions.html">diag_predictions</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Output: s, hypothesis: alt`</span></span>
<span><span class="co">#&gt;           m         n    MC_mean      MC_l95     MC_u95     p_mean      p_l95</span></span>
<span><span class="co">#&gt; 1  30.00000 12.500000 0.11155378 0.063118649 0.18963338 0.12762251 0.10772147</span></span>
<span><span class="co">#&gt; 2  40.00000  8.750000 0.08167331 0.041666820 0.15392252 0.13890888 0.11684352</span></span>
<span><span class="co">#&gt; 3  20.00000 16.250000 0.21115538 0.142069426 0.30201037 0.22166509 0.19147619</span></span>
<span><span class="co">#&gt; 4  25.00000 10.625000 0.18127490 0.117482371 0.26914262 0.22750507 0.19918432</span></span>
<span><span class="co">#&gt; 5  45.00000 18.125000 0.01195219 0.001988476 0.06841874 0.02556474 0.01226616</span></span>
<span><span class="co">#&gt; 6  35.00000  6.875000 0.23107570 0.158794949 0.32360083 0.23138686 0.20070363</span></span>
<span><span class="co">#&gt; 7  15.00000 14.375000 0.44023904 0.346374267 0.53858093 0.35342547 0.30492322</span></span>
<span><span class="co">#&gt; 8  17.50000  9.687500 0.40039841 0.309210032 0.49905109 0.38829725 0.33317646</span></span>
<span><span class="co">#&gt; 9  37.50000 17.187500 0.06175299 0.028329144 0.12936153 0.04308112 0.02818094</span></span>
<span><span class="co">#&gt; 10 47.50000  5.937500 0.20119522 0.133803478 0.29112177 0.19624201 0.14331310</span></span>
<span><span class="co">#&gt; 11 27.50000 13.437500 0.11155378 0.063118649 0.18963338 0.13983730 0.11872020</span></span>
<span><span class="co">#&gt; 12 22.50000  7.812500 0.37051793 0.281742889 0.46900021 0.35198590 0.29843680</span></span>
<span><span class="co">#&gt; 13 42.50000 15.312500 0.03187251 0.010672159 0.09130098 0.03995067 0.02444646</span></span>
<span><span class="co">#&gt; 14 32.50000 11.562500 0.10159363 0.055809001 0.17786349 0.12213350 0.10254115</span></span>
<span><span class="co">#&gt; 15 12.50000 19.062500 0.35059761 0.263632739 0.44876675 0.35459382 0.28675581</span></span>
<span><span class="co">#&gt; 16 13.75000 12.031250 0.35059761 0.263632739 0.44876675 0.41355431 0.35217076</span></span>
<span><span class="co">#&gt; 17 33.75000 19.531250 0.02191235 0.005838964 0.07872833 0.04749012 0.03065901</span></span>
<span><span class="co">#&gt; 18 43.75000  8.281250 0.12151394 0.070564158 0.20128432 0.13509492 0.10727229</span></span>
<span><span class="co">#&gt; 19 23.75000 15.781250 0.19123506 0.125606506 0.28016698 0.16106173 0.13743118</span></span>
<span><span class="co">#&gt; 20 28.75000  6.406250 0.28087649 0.201616667 0.37659748 0.30993552 0.25660633</span></span>
<span><span class="co">#&gt; 21 31.98561  8.998203 0.18127490 0.117482371 0.26914262 0.18663142 0.16437288</span></span>
<span><span class="co">#&gt; 22 21.99748 19.995216 0.17131474 0.109435453 0.25804488 0.15091308 0.12657099</span></span>
<span><span class="co">#&gt; 23 26.99935 11.997542 0.18127490 0.117482371 0.26914262 0.16935818 0.14637433</span></span>
<span><span class="co">#&gt; 24 21.99730 19.976786 0.12151394 0.070564158 0.20128432 0.15103828 0.12678562</span></span>
<span><span class="co">#&gt; 25 39.97274  6.988479 0.14143426 0.085811927 0.22426578 0.19393465 0.16840712</span></span>
<span><span class="co">#&gt; 26 20.99972 19.999855 0.22111554 0.150400931 0.31283581 0.16720993 0.14127366</span></span>
<span><span class="co">#&gt; 27 37.99189  6.993664 0.23107570 0.158794949 0.32360083 0.20584294 0.18005862</span></span>
<span><span class="co">#&gt; 28 39.99514  6.998776 0.18127490 0.117482371 0.26914262 0.19344642 0.16798199</span></span>
<span><span class="co">#&gt; 29 24.97515 13.999811 0.16135458 0.101470755 0.24686949 0.16480626 0.14107123</span></span>
<span><span class="co">#&gt; 30 39.99366  6.999902 0.26095618 0.184326258 0.35555664 0.19341562 0.16795954</span></span>
<span><span class="co">#&gt; 31 32.99968  8.999911 0.18127490 0.117482371 0.26914262 0.17763129 0.15617459</span></span>
<span><span class="co">#&gt; 32 35.95488  7.996821 0.19123506 0.125606506 0.28016698 0.18555315 0.16397734</span></span>
<span><span class="co">#&gt; 33 27.95746 10.990021 0.21115538 0.142069426 0.30201037 0.17805154 0.15493518</span></span>
<span><span class="co">#&gt; 34 36.93869  7.994242 0.23107570 0.158794949 0.32360083 0.17893502 0.15774364</span></span>
<span><span class="co">#&gt; 35 20.99066 19.995778 0.19123506 0.125606506 0.28016698 0.16739322 0.14146170</span></span>
<span><span class="co">#&gt; 36 22.97379 16.990697 0.17131474 0.109435453 0.25804488 0.16039072 0.13758832</span></span>
<span><span class="co">#&gt; 37 30.91326  9.949006 0.15139442 0.093594026 0.23561162 0.17071928 0.14900537</span></span>
<span><span class="co">#&gt; 38 20.99732 19.985637 0.12151394 0.070564158 0.20128432 0.16735196 0.14148721</span></span>
<span><span class="co">#&gt; 39 20.99805 19.995083 0.14143426 0.085811927 0.22426578 0.16727238 0.14135857</span></span>
<span><span class="co">#&gt; 40 21.99923 17.975259 0.12151394 0.070564158 0.20128432 0.16681275 0.14450253</span></span>
<span><span class="co">#&gt;         p_u95 no_overlap</span></span>
<span><span class="co">#&gt; 1  0.15057972           </span></span>
<span><span class="co">#&gt; 2  0.16436568           </span></span>
<span><span class="co">#&gt; 3  0.25511186           </span></span>
<span><span class="co">#&gt; 4  0.25855250           </span></span>
<span><span class="co">#&gt; 5  0.05251463           </span></span>
<span><span class="co">#&gt; 6  0.26520450           </span></span>
<span><span class="co">#&gt; 7  0.40514579           </span></span>
<span><span class="co">#&gt; 8  0.44643203           </span></span>
<span><span class="co">#&gt; 9  0.06532988           </span></span>
<span><span class="co">#&gt; 10 0.26272398           </span></span>
<span><span class="co">#&gt; 11 0.16401151           </span></span>
<span><span class="co">#&gt; 12 0.40953454           </span></span>
<span><span class="co">#&gt; 13 0.06463631           </span></span>
<span><span class="co">#&gt; 14 0.14486506           </span></span>
<span><span class="co">#&gt; 15 0.42883130           </span></span>
<span><span class="co">#&gt; 16 0.47774684           </span></span>
<span><span class="co">#&gt; 17 0.07286656           </span></span>
<span><span class="co">#&gt; 18 0.16876955           </span></span>
<span><span class="co">#&gt; 19 0.18787045           </span></span>
<span><span class="co">#&gt; 20 0.36884873           </span></span>
<span><span class="co">#&gt; 21 0.21114250           </span></span>
<span><span class="co">#&gt; 22 0.17897734           </span></span>
<span><span class="co">#&gt; 23 0.19512602           </span></span>
<span><span class="co">#&gt; 24 0.17897931           </span></span>
<span><span class="co">#&gt; 25 0.22229731           </span></span>
<span><span class="co">#&gt; 26 0.19681647           </span></span>
<span><span class="co">#&gt; 27 0.23426463           </span></span>
<span><span class="co">#&gt; 28 0.22174224           </span></span>
<span><span class="co">#&gt; 29 0.19164367           </span></span>
<span><span class="co">#&gt; 30 0.22170181           </span></span>
<span><span class="co">#&gt; 31 0.20133254           </span></span>
<span><span class="co">#&gt; 32 0.20925728           </span></span>
<span><span class="co">#&gt; 33 0.20378516           </span></span>
<span><span class="co">#&gt; 34 0.20228952           </span></span>
<span><span class="co">#&gt; 35 0.19698761           </span></span>
<span><span class="co">#&gt; 36 0.18615643           </span></span>
<span><span class="co">#&gt; 37 0.19487286           </span></span>
<span><span class="co">#&gt; 38 0.19686073           </span></span>
<span><span class="co">#&gt; 39 0.19684762           </span></span>
<span><span class="co">#&gt; 40 0.19179528</span></span></code></pre></div>
<p>In this example we see that the empirical estimates agree with the
predictions for all of the designs which have been evaluated. Once we
are happy with our solution and have chosen a specific design from the
Pareto set, we might want to double check that point by running a large
number of simulations at it:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_check_point.html">diag_check_point</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span>, N<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Model 1 prediction interval: [0.137, 0.188]</span></span>
<span><span class="co">#&gt; Model 1 empirical interval: [0.157, 0.161]</span></span></code></pre></div>
<p>At any point, but especially after initialisation, we may decide that
we need more points in our initial evaluations, or more simulations at
each of the points evaluated so far. We can do that via
<code><a href="../reference/extend_initial.html">extend_initial()</a></code>. For example, suppose we started off with
only 10 evaluations at each of 6 initial designs:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">98579</span><span class="op">)</span></span>
<span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking simulation speed...</span></span>
<span><span class="co">#&gt; Initialisation will take approximately 0.01507163 secs </span></span>
<span><span class="co">#&gt; Solution found</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    m      n</span></span>
<span><span class="co">#&gt; 3 20 16.250</span></span>
<span><span class="co">#&gt; 4 25 10.625</span></span>
<span><span class="co">#&gt; 6 35  6.875</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   N, alt (mean) m, alt (mean)</span></span>
<span><span class="co">#&gt; 3           320            20</span></span>
<span><span class="co">#&gt; 4           250            25</span></span>
<span><span class="co">#&gt; 6           210            35</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   s, alt (mean) s, alt (var)</span></span>
<span><span class="co">#&gt; 3    -1.3156768    0.5995565</span></span>
<span><span class="co">#&gt; 4    -1.3156768    0.5995565</span></span>
<span><span class="co">#&gt; 6    -0.3894648    0.4153610</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol_init</span> <span class="op">&lt;-</span> <span class="va">sol</span></span>
<span></span>
<span><span class="co"># Take the first solution in the Pareto set and plot diagnostics:</span></span>
<span><span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;    m     n   N  m</span></span>
<span><span class="co">#&gt; 3 20 16.25 320 20</span></span>
<span><span class="fu"><a href="../reference/diag_plots.html">diag_plots</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-15-2.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span></code></pre>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-15-3.png" width="700"></p>
<p>The diagnostic plots here show a GP model of the true power function
which is just a constant, which we know is not true. When we see a poor
initial fit like this we might want to add more simulations to designs
already evaluated, or add more designs, or both. We can use the
<code><a href="../reference/extend_initial.html">extend_initial()</a></code> function for this. For example, suppose we
want an extra 4 designs and for every design to have 500
simulations:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_initial.html">extend_initial</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span>, extra_points <span class="op">=</span> <span class="fl">4</span>, extra_N <span class="op">=</span> <span class="fl">490</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;       m      n   N  m</span></span>
<span><span class="co">#&gt; 10 47.5 5.9375 235 47</span></span>
<span><span class="fu"><a href="../reference/diag_plots.html">diag_plots</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span></code></pre>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-16-2.png" width="700"></p>
<p>Our lots now suggest a more plausible model.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Wilson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
