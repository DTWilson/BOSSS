<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BOSSS • BOSSS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BOSSS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BOSSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/BOSSS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Examples.html">Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>BOSSS</h1>
            
      

      <div class="d-none name"><code>BOSSS.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dtwilson.github.io/BOSSS/">BOSSS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<!-- Note - a Twitter thread on power analysis had a couple of people mentioning the R package simr for power through simulation when using mixed models. So might be worth including that in one of our examples, to save people having to write their own simulation code? -->
<p>Every application of BOSSS follows the same set of steps:</p>
<ol style="list-style-type: decimal">
<li>Formally specify the problem and create a corresponding
<code>BOSSS_problem</code> object;</li>
<li>Create a <code>BOSSS_solution</code> object and initialise it;</li>
<li>Perform a number of iterations, each one updating and (hopefully)
improving the <code>BOSSS_solution</code> object;</li>
<li>Select a final design and run some diagnostics to check it is
valid.</li>
</ol>
<p>We will work through these steps here for an example problem:
designing a cluster randomised trial. For more illustrations, see the
“Examples” article.</p>
<div class="section level3">
<h3 id="problem">Problem<a class="anchor" aria-label="anchor" href="#problem"></a>
</h3>
<p>The first ingredient of a BOSSS problem is the simulation function.
The arguments of this function must first specify the <em>design
variables</em> which we want to vary in our problem, followed by the
<em>model parameters</em>. In this example we have two design variables
representing the number of clusters in each arm, and the number of
participants in each arm. The model parameters are the mean difference
in outcome between the control and experimental arms
(<code>beta_1</code>), the within-cluster standard deviation
(<code>sig_w</code>), and the between-cluster standard deviation
(<code>sig_b</code>). Note that all of these inputs require some
defaults to be provided.</p>
<p>The other element of interface the simulation function must conform
to is in its return value, which should be a named vector of the
quantities who’s mean values we want to estimate using the Monte Carlo
method. Here, we have one such quantity: a boolean indicator of a
negative decision, <code>s</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_cRCT</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">200</span>, <span class="va">beta_1</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="va">sig_w</span> <span class="op">=</span> <span class="fl">0.975</span>, <span class="va">sig_b</span> <span class="op">=</span> <span class="fl">0.224</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span>; <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">k</span>, sd <span class="op">=</span> <span class="va">sig_b</span><span class="op">)</span></span>
<span>  <span class="va">cluster_size</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span><span class="va">k</span>, <span class="va">k</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="va">k</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">k</span> <span class="op">-</span> <span class="va">n</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">u_c</span>, times <span class="op">=</span> <span class="va">cluster_size</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="va">sig_w</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">u_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">k</span>, sd <span class="op">=</span> <span class="va">sig_b</span><span class="op">)</span></span>
<span>  <span class="va">y_i</span> <span class="op">&lt;-</span> <span class="va">beta_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">u_i</span>, times <span class="op">=</span> <span class="va">cluster_size</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="va">sig_w</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">y_i</span>, <span class="va">y_c</span>, alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># For example,</span></span>
<span><span class="fu">sim_cRCT</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     s </span></span>
<span><span class="co">#&gt; FALSE</span></span></code></pre></div>
<p>In our problem we are not just interested in the expected value of
<code>s</code>; we also want to minimise the number of clusters and the
number of participants, and to put an upper limit on the number of
participants per cluster. Since these are fixed quantities given any
design, we evaluate them in a separate deterministic function. This
should conform to the same principles as the simulation function, with
the same inputs, but allowing for different named outputs. Here, the
outputs are just <code>k</code>, <code>n</code>, and
<code>m = n/k</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">det_cRCT</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">200</span>, <span class="va">beta_1</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="va">sig_w</span> <span class="op">=</span> <span class="fl">0.975</span>, <span class="va">sig_b</span> <span class="op">=</span> <span class="fl">0.224</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>k <span class="op">=</span> <span class="va">k</span>, n <span class="op">=</span> <span class="va">n</span>, m <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, we need to note the ranges of the design variables which we
plan to search over. We use the <code><a href="../reference/design_space.html">design_space()</a></code> function for
this, specifying the lower and upper limits of the design variables in
the order they appear as simulation function arguments:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_space.html">design_space</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>, </span>
<span>                             upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                             sim <span class="op">=</span> <span class="va">sim_cRCT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_space</span></span>
<span><span class="co">#&gt;   name lower upper</span></span>
<span><span class="co">#&gt; 1    k    10   100</span></span>
<span><span class="co">#&gt; 2    n   100   500</span></span></code></pre></div>
<p>Note that the function automatically retrieves the names of the
design variables based on the order they take in the simulation
function.</p>
<p>We also need to specify the hypotheses which we’re planning to
simulate under, using the <code><a href="../reference/hypotheses.html">hypotheses()</a></code> function, again
specifying in the order that parameters appear as simulation function
argument. We only need one hypothesis here, the alternative, since we
will be estimating the type II error rate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hypotheses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypotheses.html">hypotheses</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         hyp_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                         sim <span class="op">=</span> <span class="va">sim_cRCT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypotheses</span></span>
<span><span class="co">#&gt;              alt</span></span>
<span><span class="co">#&gt; beta_1 0.3000000</span></span>
<span><span class="co">#&gt; sig_w  0.9746794</span></span>
<span><span class="co">#&gt; sig_b  0.2236068</span></span></code></pre></div>
<p>Constraints should be specified using the <code>constraints</code>
function. Each constraint should be named, and should be defined with
respect to a specific output and a specific hypothesis. It should have a
nominal maximum value, and a probability <code>delta</code> used to
judge if it is satisfied. Here, our fist constraint is that the mean of
the simulation output (i.e. the probability of a negative result) under
the <code>alt</code> hypothesis should be less than or equal to 0.2 with
a probability of at least 0.95. The second constraint is that the
cluster size <code>m</code> under the <code>alt</code> hypothesis must
be less than or equal to 10 - note that we provide a value for
<code>delta</code>, but this isn’t used since the constraint is
deterministic. Finally, we note whether the constraint output is binary
or otherwise.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraints.html">constraints</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"con_tII"</span>, <span class="st">"con_m"</span><span class="op">)</span>,</span>
<span>                   out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="st">"m"</span><span class="op">)</span>,</span>
<span>                   hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                   nom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                   delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">constraints</span></span>
<span><span class="co">#&gt;      name out hyp  nom delta binary</span></span>
<span><span class="co">#&gt; 1 con_tII   s alt  0.2  0.95   TRUE</span></span>
<span><span class="co">#&gt; 2   con_m   m alt 10.0  1.00  FALSE</span></span></code></pre></div>
<p>The final ingredient of the problem is the set of objectives we want
to minimise. Similar to constraints, objectives are tied to a specific
output and hypothesis. We also specify weights for each objective which
help guide the internal optimisation process, and note whether or not
the output for each objective is binary or continuous. For example, here
we want to minimise both the number of patients <code>n</code> and the
number of clusters <code>k</code>, with the latter carrying a weight of
100 times that of the former.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">objectives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/objectives.html">objectives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"k"</span><span class="op">)</span>,</span>
<span>                 out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"k"</span><span class="op">)</span>,</span>
<span>                 hyp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alt"</span>, <span class="st">"alt"</span><span class="op">)</span>,</span>
<span>                 weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                 binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objectives</span></span>
<span><span class="co">#&gt;   name out hyp weight binary</span></span>
<span><span class="co">#&gt; 1    n   n alt      1  FALSE</span></span>
<span><span class="co">#&gt; 2    k   k alt     10  FALSE</span></span></code></pre></div>
<p>We now put this simulation function and set of data frames together
to create an object of class <code>BOSSS_problem</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_problem.html">BOSSS_problem</a></span><span class="op">(</span><span class="va">sim_cRCT</span>, <span class="va">design_space</span>, <span class="va">hypotheses</span>, <span class="va">objectives</span>, <span class="va">constraints</span>, det_func <span class="op">=</span> <span class="va">det_cRCT</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initialisation">Initialisation<a class="anchor" aria-label="anchor" href="#initialisation"></a>
</h3>
<p>Having set up the problem, we now need to create an initial solution
to it. This involves setting up a space-filling set of designs spanning
the design space (where <code>size</code> is the number of designs),
computing the Monte Carlo estimates of all the expectations we are
interested in at each of these designs (using <code>N</code> samples for
each evaluation), fitting Gaussian Process models to these estimates,
and then using those models to estimate the Pareto set and front:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BOSSS_solution.html">BOSSS_solution</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">N</span>, <span class="va">prob</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking simulation speed...</span></span>
<span><span class="co">#&gt; Initialisation will take approximately 2.720101 secs </span></span>
<span><span class="co">#&gt; Solution found</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         k   n</span></span>
<span><span class="co">#&gt; 6  66.250 150</span></span>
<span><span class="co">#&gt; 8  26.875 225</span></span>
<span><span class="co">#&gt; 12 38.125 175</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n, alt (mean) k, alt (mean)</span></span>
<span><span class="co">#&gt; 6            150        66.250</span></span>
<span><span class="co">#&gt; 8            225        26.875</span></span>
<span><span class="co">#&gt; 12           175        38.125</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, alt (mean) s, alt (var) m, alt (mean)</span></span>
<span><span class="co">#&gt; 6      -1.732408   0.01564970      2.264151</span></span>
<span><span class="co">#&gt; 8      -2.644208   0.03226089      8.372093</span></span>
<span><span class="co">#&gt; 12     -1.863526   0.01718935      4.590164</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function will give a table of the Pareto set
with associated objective function values. The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
function will plot the Pareto front.</p>
</div>
<div class="section level3">
<h3 id="iteration">Iteration<a class="anchor" aria-label="anchor" href="#iteration"></a>
</h3>
<p>We can now start improving this solution by calling the
<code><a href="../reference/iterate.html">iterate()</a></code> function. Each call uses the fitted Gaussian
Process models to decide on the next design to be evaluated, computes
the Monte Carlo estimates at that point, and then updates the estimated
Pareto set and front.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iterate.html">iterate</a></span><span class="op">(</span><span class="va">sol</span>, <span class="va">prob</span>, <span class="va">N</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design variables for the Pareto set: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           k        n</span></span>
<span><span class="co">#&gt; 6  66.25000 150.0000</span></span>
<span><span class="co">#&gt; 24 35.39951 157.9180</span></span>
<span><span class="co">#&gt; 26 17.17720 171.7621</span></span>
<span><span class="co">#&gt; 28 23.37763 163.0784</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Corresponding objective function values... </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    n, alt (mean) k, alt (mean)</span></span>
<span><span class="co">#&gt; 6       150.0000      66.25000</span></span>
<span><span class="co">#&gt; 24      157.9180      35.39951</span></span>
<span><span class="co">#&gt; 26      171.7621      17.17720</span></span>
<span><span class="co">#&gt; 28      163.0784      23.37763</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...and constraint function values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    s, alt (mean) s, alt (var) m, alt (mean)</span></span>
<span><span class="co">#&gt; 6      -1.732408   0.01564970      2.264151</span></span>
<span><span class="co">#&gt; 24     -1.555727   0.01388802      4.461022</span></span>
<span><span class="co">#&gt; 26     -1.671131   0.01500043      9.999422</span></span>
<span><span class="co">#&gt; 28     -1.501149   0.01340870      6.975829</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<p>To check the GP models are giving sensible predictions, we can choose
a specific design and then plot the predictions for each model along the
range of each design variable.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pick a specific design from the Pareto set</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/diag_plots.html">diag_plots</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span></code></pre>
<p><img src="BOSSS_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<p>We can also get the predicted values and 95% credible intervals for
each point we have evaluated, contrasting these with the empirical MC
estimate and interval. This will return a data frame for each of the
models, named according to the output-hypothesis combination which
defines it. We highlight with a <code>*</code> any points where the two
intervals do not overlap.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diag_predictions.html">diag_predictions</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Output: s, hypothesis: alt`</span></span>
<span><span class="co">#&gt;           k        n     MC_mean      MC_l95     MC_u95      p_mean       p_l95</span></span>
<span><span class="co">#&gt; 1  55.00000 300.0000 0.032374101 0.028678214 0.03652838 0.033091347 0.025642104</span></span>
<span><span class="co">#&gt; 2  77.50000 200.0000 0.120303757 0.116441676 0.12427592 0.092546471 0.078025395</span></span>
<span><span class="co">#&gt; 3  32.50000 400.0000 0.030375699 0.026694246 0.03454685 0.029961720 0.021969747</span></span>
<span><span class="co">#&gt; 4  43.75000 250.0000 0.046362910 0.042599804 0.05044092 0.050532474 0.040785724</span></span>
<span><span class="co">#&gt; 5  88.75000 450.0000 0.004396483 0.001801431 0.01068980 0.006329806 0.003161094</span></span>
<span><span class="co">#&gt; 6  66.25000 150.0000 0.150279776 0.146404852 0.15423873 0.183013717 0.167879333</span></span>
<span><span class="co">#&gt; 7  21.25000 350.0000 0.064348521 0.060540980 0.06837810 0.054921222 0.042174099</span></span>
<span><span class="co">#&gt; 8  26.87500 225.0000 0.066346922 0.062535896 0.07037276 0.078423630 0.064160017</span></span>
<span><span class="co">#&gt; 9  71.87500 425.0000 0.012390088 0.009026885 0.01698486 0.009864777 0.006221843</span></span>
<span><span class="co">#&gt; 10 94.37500 125.0000 0.224220624 0.220328166 0.22816172 0.222943236 0.189712392</span></span>
<span><span class="co">#&gt; 11 49.37500 325.0000 0.036370903 0.032650733 0.04049720 0.032920497 0.025479515</span></span>
<span><span class="co">#&gt; 12 38.12500 175.0000 0.134292566 0.130423804 0.13825784 0.143889868 0.129220754</span></span>
<span><span class="co">#&gt; 13 83.12500 375.0000 0.010391687 0.007123712 0.01513598 0.013969502 0.008439837</span></span>
<span><span class="co">#&gt; 14 60.62500 275.0000 0.028377298 0.024712216 0.03256780 0.035862707 0.027678720</span></span>
<span><span class="co">#&gt; 15 15.62500 475.0000 0.026378897 0.022732542 0.03059183 0.025639129 0.015533637</span></span>
<span><span class="co">#&gt; 16 18.43750 287.5000 0.062350120 0.058546281 0.06638367 0.060205641 0.046750122</span></span>
<span><span class="co">#&gt; 17 63.43750 487.5000 0.004396483 0.001801431 0.01068980 0.007505095 0.003622947</span></span>
<span><span class="co">#&gt; 18 85.93750 187.5000 0.098321343 0.094473461 0.10230824 0.112637423 0.093961706</span></span>
<span><span class="co">#&gt; 19 40.93750 387.5000 0.020383693 0.016814150 0.02469200 0.026853657 0.020096697</span></span>
<span><span class="co">#&gt; 20 52.18750 137.5000 0.194244604 0.190357754 0.19819139 0.212879117 0.194021370</span></span>
<span><span class="co">#&gt; 21 16.02877 160.2877 0.220223821 0.216332030 0.22416560 0.199650899 0.178160264</span></span>
<span><span class="co">#&gt; 22 17.93091 179.3085 0.158273381 0.154395824 0.16222964 0.155650798 0.139765791</span></span>
<span><span class="co">#&gt; 23 51.30692 144.8900 0.204236611 0.200347724 0.20818133 0.198274630 0.184546552</span></span>
<span><span class="co">#&gt; 24 35.39951 157.9180 0.174260592 0.170378459 0.17821218 0.181974980 0.168790182</span></span>
<span><span class="co">#&gt; 25 55.97804 145.2374 0.214228617 0.210337869 0.21817145 0.195421787 0.182093674</span></span>
<span><span class="co">#&gt; 26 17.17720 171.7621 0.158273381 0.154395824 0.16222964 0.172418351 0.156159056</span></span>
<span><span class="co">#&gt; 27 55.82865 147.4829 0.184252598 0.180367987 0.18820166 0.190868589 0.177948446</span></span>
<span><span class="co">#&gt; 28 23.37763 163.0784 0.182254197 0.178370061 0.18620374 0.183746159 0.169378836</span></span>
<span><span class="co">#&gt; 29 42.17415 151.8225 0.206235012 0.202345740 0.21017934 0.189448232 0.176176251</span></span>
<span><span class="co">#&gt; 30 66.69676 145.3298 0.208233413 0.204343763 0.21217736 0.192271307 0.177094049</span></span>
<span><span class="co">#&gt;         p_u95 no_overlap</span></span>
<span><span class="co">#&gt; 1  0.04261002           </span></span>
<span><span class="co">#&gt; 2  0.10944921          *</span></span>
<span><span class="co">#&gt; 3  0.04073984           </span></span>
<span><span class="co">#&gt; 4  0.06245679           </span></span>
<span><span class="co">#&gt; 5  0.01263461           </span></span>
<span><span class="co">#&gt; 6  0.19918588          *</span></span>
<span><span class="co">#&gt; 7  0.07123463           </span></span>
<span><span class="co">#&gt; 8  0.09553452           </span></span>
<span><span class="co">#&gt; 9  0.01560718           </span></span>
<span><span class="co">#&gt; 10 0.26012627           </span></span>
<span><span class="co">#&gt; 11 0.04243989           </span></span>
<span><span class="co">#&gt; 12 0.15991840           </span></span>
<span><span class="co">#&gt; 13 0.02303795           </span></span>
<span><span class="co">#&gt; 14 0.04635116           </span></span>
<span><span class="co">#&gt; 15 0.04203808           </span></span>
<span><span class="co">#&gt; 16 0.07722018           </span></span>
<span><span class="co">#&gt; 17 0.01548250           </span></span>
<span><span class="co">#&gt; 18 0.13447417           </span></span>
<span><span class="co">#&gt; 19 0.03579946           </span></span>
<span><span class="co">#&gt; 20 0.23303978           </span></span>
<span><span class="co">#&gt; 21 0.22303035           </span></span>
<span><span class="co">#&gt; 22 0.17297817           </span></span>
<span><span class="co">#&gt; 23 0.21275748           </span></span>
<span><span class="co">#&gt; 24 0.19594690           </span></span>
<span><span class="co">#&gt; 25 0.20947559          *</span></span>
<span><span class="co">#&gt; 26 0.18998941           </span></span>
<span><span class="co">#&gt; 27 0.20449346           </span></span>
<span><span class="co">#&gt; 28 0.19904014           </span></span>
<span><span class="co">#&gt; 29 0.20347310           </span></span>
<span><span class="co">#&gt; 30 0.20841985</span></span></code></pre></div>
<p>If things aren’t looking too good, it may indicate that we need more
points in our initial evaluations, or more simulations at each of those
points. We can do that via <code><a href="../reference/extend_initial.html">extend_initial()</a></code>. For example,
suppose we want to add an extra 500 simulations to our initial
points:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_initial.html">extend_initial</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span>, extra_N <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the first threee designs; the empirical and predicted estimates will have changed</span></span>
<span><span class="fu"><a href="../reference/diag_predictions.html">diag_predictions</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      k   n    MC_mean     MC_l95     MC_u95     p_mean      p_l95      p_u95</span></span>
<span><span class="co">#&gt; 1 55.0 300 0.03218713 0.03028455 0.03420501 0.03269835 0.02761516 0.03868000</span></span>
<span><span class="co">#&gt; 2 77.5 200 0.11215514 0.11021086 0.11412932 0.09341229 0.08294992 0.10504311</span></span>
<span><span class="co">#&gt; 3 32.5 400 0.03018792 0.02828915 0.03220992 0.02686743 0.02175458 0.03314123</span></span>
<span><span class="co">#&gt;   no_overlap</span></span>
<span><span class="co">#&gt; 1           </span></span>
<span><span class="co">#&gt; 2          *</span></span>
<span><span class="co">#&gt; 3</span></span></code></pre></div>
<p>Or, we could add another 10 points:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_initial.html">extend_initial</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span>, extra_points <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the added designs, which go to the top of the table</span></span>
<span><span class="fu"><a href="../reference/diag_predictions.html">diag_predictions</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">sol</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;          k     n    MC_mean      MC_l95     MC_u95      p_mean       p_l95</span></span>
<span><span class="co">#&gt; 21 97.1875 337.5 0.02119152 0.019318445 0.02324191 0.021881172 0.016601510</span></span>
<span><span class="co">#&gt; 22 74.6875 237.5 0.06217513 0.060244532 0.06416337 0.063321775 0.056422403</span></span>
<span><span class="co">#&gt; 23 29.6875 437.5 0.02319072 0.021310262 0.02523284 0.022298306 0.018245284</span></span>
<span><span class="co">#&gt; 24 24.0625 162.5 0.15413834 0.152189330 0.15610772 0.177931107 0.166140500</span></span>
<span><span class="co">#&gt; 25 69.0625 362.5 0.01619352 0.014346558 0.01827386 0.017643852 0.014543019</span></span>
<span><span class="co">#&gt; 26 91.5625 262.5 0.06117553 0.059245429 0.06316429 0.050233467 0.042388058</span></span>
<span><span class="co">#&gt; 27 46.5625 462.5 0.01119552 0.009396651 0.01333413 0.011258177 0.008375788</span></span>
<span><span class="co">#&gt; 28 35.3125 212.5 0.10715714 0.105213659 0.10913214 0.095396210 0.086751027</span></span>
<span><span class="co">#&gt; 29 80.3125 412.5 0.01219512 0.010383646 0.01431805 0.009723699 0.007360749</span></span>
<span><span class="co">#&gt; 30 57.8125 112.5 0.29508197 0.293126575 0.29704492 0.285795374 0.262791195</span></span>
<span><span class="co">#&gt;         p_u95 no_overlap</span></span>
<span><span class="co">#&gt; 21 0.02879073           </span></span>
<span><span class="co">#&gt; 22 0.07100132           </span></span>
<span><span class="co">#&gt; 23 0.02722670           </span></span>
<span><span class="co">#&gt; 24 0.19036744          *</span></span>
<span><span class="co">#&gt; 25 0.02139149           </span></span>
<span><span class="co">#&gt; 26 0.05944081           </span></span>
<span><span class="co">#&gt; 27 0.01511737           </span></span>
<span><span class="co">#&gt; 28 0.10480406          *</span></span>
<span><span class="co">#&gt; 29 0.01283540           </span></span>
<span><span class="co">#&gt; 30 0.30996659</span></span></code></pre></div>
<p>Once we are happy with our solution and have chosen a specific design
from the Pareto set, we might want to double check that point by running
a large number of simulations at it.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">p_set</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_check_point.html">diag_check_point</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span>, N<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">4</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Model 1 prediction interval: [0.177, 0.202]</span></span>
<span><span class="co">#&gt; Model 1 empirical interval: [0.179, 0.194]</span></span></code></pre></div>
<p>If we decide we want to run more simulations at the same point, we
can pass the previous results in so they are built upon.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_check_point.html">diag_check_point</a></span><span class="op">(</span><span class="va">design</span>, <span class="va">prob</span>, <span class="va">sol</span>, N<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">4</span>, <span class="va">r</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Model 1 prediction interval: [0.177, 0.202]</span></span>
<span><span class="co">#&gt; Model 1 empirical interval: [0.18, 0.191]</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Wilson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
